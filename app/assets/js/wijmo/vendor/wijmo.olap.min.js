/*
    *
    * Wijmo Library 5.20171.282
    * http://wijmo.com/
    *
    * Copyright(c) GrapeCity, Inc.  All rights reserved.
    *
    * Licensed under the Wijmo Commercial License.
    * sales@wijmo.com
    * wijmo.com/products/wijmo-5/license/
    *
    */
var __extends,wijmo;(function(n){var t;(function(t){'use strict';var i=function(){function t(){this._cnt=0;this._cntn=0;this._sum=0;this._sum2=0;this._min=null;this._max=null}return t.prototype.add=function(i,r){i instanceof t?(this._sum+=i._sum,this._sum2+=i._sum2,this._max=this._max&&i._max?Math.max(this._max,i._max):this._max||i._max,this._min=this._min&&i._min?Math.min(this._min,i._min):this._min||i._min,this._cnt+=i._cnt,this._cntn+=i._cntn):i!=null&&(this._cnt++,(this._min==null||i<this._min)&&(this._min=i),(this._max==null||i>this._max)&&(this._max=i),n.isNumber(i)&&!isNaN(i)?(n.isNumber(r)&&(i*=r),this._cntn++,this._sum+=i,this._sum2+=i*i):n.isBoolean(i)&&(this._cntn++,i==!0&&(this._sum++,this._sum2++)))},t.prototype.getAggregate=function(t){if(this._cnt==0)return null;var i=this._cntn==0?0:this._sum/this._cntn;switch(t){case n.Aggregate.Avg:return i;case n.Aggregate.Cnt:return this._cnt;case n.Aggregate.Max:return this._max;case n.Aggregate.Min:return this._min;case n.Aggregate.Rng:return this._max-this._min;case n.Aggregate.Sum:return this._sum;case n.Aggregate.VarPop:return this._cntn<=1?0:this._sum2/this._cntn-i*i;case n.Aggregate.StdPop:return this._cntn<=1?0:Math.sqrt(this._sum2/this._cntn-i*i);case n.Aggregate.Var:return this._cntn<=1?0:(this._sum2/this._cntn-i*i)*this._cntn/(this._cntn-1);case n.Aggregate.Std:return this._cntn<=1?0:Math.sqrt((this._sum2/this._cntn-i*i)*this._cntn/(this._cntn-1))}throw'Invalid aggregate type.';},t}();t._Tally=i})(t=n.olap||(n.olap={}))})(wijmo||(wijmo={})),function(n){var t;(function(t){'use strict';var i=function(){function t(n,t,i,r,u){this._fields=n;this._fieldCount=t;this._valueFields=i;this._valueFieldIndex=r;this._item=u}return Object.defineProperty(t.prototype,"fields",{get:function(){return this._fields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"valueFields",{get:function(){return this._valueFields},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"values",{get:function(){var n,t;if(this._vals==null)for(this._vals=new Array(this._fieldCount),n=0;n<this._fieldCount;n++)t=this._fields[n],this._vals[n]=t._getValue(this._item,!1);return this._vals},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"fieldNames",{get:function(){var n,t;if(!this._names)for(this._names=[],n=0;n<this.fields.length;n++)t=this._fields[n],this._names.push(t._getName());return this._names},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"aggregate",{get:function(){var t=this._valueFields,i=this._valueFieldIndex;return n.assert(t&&i>-1&&i<t.length,'aggregate not available for this key'),t[i].aggregate},enumerable:!0,configurable:!0}),t.prototype.getValue=function(t,i){if(this.values.length==0)return n.culture.olap.PivotEngine.grandTotal;if(t>this.values.length-1)return n.culture.olap.PivotEngine.subTotal;var r=this.values[t];return i&&!n.isString(r)&&(r=n.Globalize.format(this.values[t],this.fields[t].format)),r},t.prototype.compareTo=function(t){var i=0,r,h,o,y;if(t!=null&&t._fields==this._fields){var u=this.values,s=t.values,p=Math.min(u.length,s.length);for(r=0;r<p;r++){var w=u[r]!=null?n.getType(u[r]):null,f=u[r],e=s[r];if(w==n.DataType.Date&&(h=this._fields[r],o=h.format,o&&o!='d'&&o!='D')){var c=h._getValue(this._item,!0),l=h._getValue(t._item,!0),a=n.Globalize.parseDate(c,o),v=n.Globalize.parseDate(l,o);a&&v?(f=a,e=v):(f=c,e=l)}if(y=f==e||n.DateTime.equals(f,e),!y)return f==null?1:e==null?-1:(i=f<e?-1:1,this._fields[r].descending?-i:i)}if(u.length==s.length&&(i=this._valueFieldIndex-t._valueFieldIndex,i!=0))return i;if(i=s.length-u.length,i!=0)return i*(this.fields.engine.totalsBeforeData?-1:1)}return 0},t.prototype.matchesItem=function(n){for(var i,r,t=0;t<this._vals.length;t++)if(i=this.getValue(t,!0),r=this._fields[t]._getValue(n,!0),i!=r)return!1;return!0},t.prototype.toString=function(){var n,t,i,r;if(!this._key){for(n='',t=0;t<this._fieldCount;t++)i=this._fields[t],n+=i._getName()+':'+i._getValue(this._item,!0)+';';this._valueFields?(r=this._valueFields[this._valueFieldIndex],n+=r._getName()+':0;'):n+='{total}';this._key=n}return this._key},t._ROW_KEY_NAME='$rowKey',t}();t._PivotKey=i})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={})),function(n){var t;(function(n){'use strict';var t=function(){function t(t,i,r,u,f,e){this._key=new n._PivotKey(t,i,r,u,f);this._nodes={};this._parent=e}return t.prototype.getNode=function(n,i,r,u,f){for(var s,e,o=this,h=0;h<i;h++)s=n[h]._getValue(f,!0),e=o._nodes[s],e||(e=new t(n,h+1,r,u,f,o),o._nodes[s]=e),o=e;return r&&u>-1&&(s=r[u].header,e=o._nodes[s],e||(e=new t(n,i,r,u,f,o),o._nodes[s]=e),o=e),o},Object.defineProperty(t.prototype,"key",{get:function(){return this._key},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"tree",{get:function(){return this._tree||(this._tree=new t(null,0,null,-1,null)),this._tree},enumerable:!0,configurable:!0}),t}();n._PivotNode=t})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';var i=function(i){function r(r){i.call(this);this._ng=n.asType(r,t.PivotEngine,!1)}return __extends(r,i),Object.defineProperty(r.prototype,"engine",{get:function(){return this._ng},enumerable:!0,configurable:!0}),r.prototype._performSort=function(n){for(var r,f,u,e=this._ng,t=0;t<n.length;t++)if(!(e._getRowLevel(t)>-1)){for(r=t;r<n.length-1;r++)if(e._getRowLevel(r+1)>-1)break;if(r>t)for(f=n.slice(t,r+1),i.prototype._performSort.call(this,f),u=0;u<f.length;u++)n[t+u]=f[u];t=r}},r}(n.collections.CollectionView);t.PivotCollectionView=i})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';var i=function(){function i(i,r,u,f){this.propertyChanged=new n.Event;this._ng=i;this._binding=new n.Binding(r);this._header=u?u:n.toHeaderCase(r);this._aggregate=n.Aggregate.Sum;this._showAs=t.ShowAs.NoCalculation;this._isContentHtml=!1;this._format='';this._filter=new t.PivotFilter(this);f&&n.copy(this,f)}return Object.defineProperty(i.prototype,"binding",{get:function(){return this._binding?this._binding.path:null},set:function(t){var u,r,i,f,e;if(t!=this.binding){u=this.binding;r=n.asString(t);this._binding=r?new n.Binding(r):null;!this._dataType&&this._ng&&this._binding&&(i=this._ng.collectionView,i&&i.sourceCollection&&i.sourceCollection.length&&(f=i.sourceCollection[0],this._dataType=n.getType(this._binding.getValue(f))));e=new n.PropertyChangedEventArgs('binding',u,t);this.onPropertyChanged(e)}},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"header",{get:function(){return this._header},set:function(t){t=n.asString(t,!1);var i=this._ng.fields.getField(t);!t||i&&i!=this?n.assert(!1,'field headers must be unique and non-empty.'):this._setProp('_header',n.asString(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filter",{get:function(){return this._filter},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"aggregate",{get:function(){return this._aggregate},set:function(t){this._setProp('_aggregate',n.asEnum(t,n.Aggregate))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"showAs",{get:function(){return this._showAs},set:function(i){this._setProp('_showAs',n.asEnum(i,t.ShowAs))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"weightField",{get:function(){return this._weightField},set:function(t){this._setProp('_weightField',n.asType(t,i,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dataType",{get:function(){return this._dataType},set:function(t){this._setProp('_dataType',n.asEnum(t,n.DataType))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"format",{get:function(){return this._format},set:function(t){this._setProp('_format',n.asString(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"width",{get:function(){return this._width},set:function(t){this._setProp('_width',n.asNumber(t,!0,!0))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"wordWrap",{get:function(){return this._wordWrap},set:function(t){this._setProp('_wordWrap',n.asBoolean(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"descending",{get:function(){return this._descending?!0:!1},set:function(t){this._setProp('_descending',n.asBoolean(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isContentHtml",{get:function(){return this._isContentHtml},set:function(t){this._setProp('_isContentHtml',n.asBoolean(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"engine",{get:function(){return this._ng},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"collectionView",{get:function(){return this.engine?this.engine.collectionView:null},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"isActive",{get:function(){return this._getIsActive()},set:function(n){this._setIsActive(n)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"parentField",{get:function(){return this._parent},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"key",{get:function(){return this.header},enumerable:!0,configurable:!0}),i.prototype.onPropertyChanged=function(n){this.propertyChanged.raise(this,n);this._ng._fieldPropertyChanged(this,n)},i.prototype._getIsActive=function(){var i,n,r,t;if(this._ng)for(i=this._ng._viewLists,n=0;n<i.length;n++)for(r=i[n],t=0;t<r.length;t++)if(r[t].binding==this.binding)return!0;return!1},i.prototype._setIsActive=function(t){var o,e,f,r,i,u;if(this._ng&&(o=this.isActive,t=n.asBoolean(t),t!=o))if(t)this.dataType==n.DataType.Number?this._ng.valueFields.push(this):this._ng.rowFields.push(this);else{for(e=this._ng._viewLists,f=0;f<e.length;f++)for(r=e[f],i=0;i<r.length;i++)u=r[i],(u==this||u.parentField==this)&&(r.removeAt(i),i--);for(r=this._ng.fields,i=r.length-1;i>=0;i--)u=r[i],u.parentField==this&&(r.removeAt(i),i--)}},i.prototype._clone=function(){var n=new i(this._ng,this.binding),u,t,r;for(this._ng._copyProps(n,this,i._props),n._autoGenerated=!0,n._parent=this,u=this.header.replace(/\d+$/,''),t=2;;t++)if(r=u+t.toString(),this._ng.fields.getField(r)==null){n._header=r;break}return n},i.prototype._setProp=function(t,i){var r=this[t],u;if(i!=r){this[t]=i;u=new n.PropertyChangedEventArgs(t.substr(1),r,i);this.onPropertyChanged(u)}},i.prototype._getName=function(){return this.header||this.binding},i.prototype._getValue=function(t,i){var r=this._binding._key?t[this._binding._key]:this._binding.getValue(t);return!i||typeof r=='string'?r:n.Globalize.format(r,this._format)},i.prototype._getWeight=function(t){var i=this._weightField?this._weightField._getValue(t,!1):null;return n.isNumber(i)?i:null},i._props=['dataType','format','width','wordWrap','aggregate','showAs','descending','isContentHtml'],i}(),r,u;t.PivotField=i;r=function(t){function i(i,r,u,f){t.call(this,i,r,u,f);var e=this.binding!=null&&r.length>0;this.subFields!=null&&this.subFields.length>0?n.assert(!e,'Fields with sub-fields should not have bindings.'):n.assert(e,'Fields without sub-fields should have bindings.')}return __extends(i,t),Object.defineProperty(i.prototype,"header",{get:function(){return this._header},set:function(t){this._setProp('_header',n.asString(t))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"dimensionType",{get:function(){return this._dimensionType},set:function(t){this._setProp('_dimensionType',n.asEnum(t,u,!1))},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"subFields",{get:function(){return this._subFields},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"key",{get:function(){return this.binding},enumerable:!0,configurable:!0}),i.prototype._clone=function(){throw'CubePivotField objects cannot be cloned';},i.prototype._copy=function(n,t){var i=this;return n=='subFields'?(this._subFields?this._subFields.splice(0,this._subFields.length):this._subFields=[],t&&t.length&&t.forEach(function(n){var t=i.engine._createField(n,i._autoGenerated);i._subFields.push(t)}),!0):!1},i.prototype._getIsActive=function(){return this.subFields&&this.subFields.length?!1:t.prototype._getIsActive.call(this)},i.prototype._setIsActive=function(n){this.subFields&&this.subFields.length||t.prototype._setIsActive.call(this,n)},i}(i);t.CubePivotField=r,function(n){n[n.Dimension=0]="Dimension";n[n.Measure=1]="Measure";n[n.Kpi=2]="Kpi";n[n.NameSet=3]="NameSet";n[n.Attribute=4]="Attribute";n[n.Folder=5]="Folder";n[n.Hierarchy=6]="Hierarchy";n[n.Date=7]="Date";n[n.Currency=8]="Currency"}(t.DimensionType||(t.DimensionType={}));u=t.DimensionType})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';var i=function(i){function r(n){i.call(this);this._ng=n}return __extends(r,i),Object.defineProperty(r.prototype,"maxItems",{get:function(){return this._maxItems},set:function(t){this._maxItems=n.asInt(t,!0,!0)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"engine",{get:function(){return this._ng},enumerable:!0,configurable:!0}),r.prototype.getField=function(n){return this._getField(this,n)},r.prototype._getField=function(n,i){for(var r,u=0;u<n.length;u++)if((r=n[u],r.key==i)||r instanceof t.CubePivotField&&r.subFields&&(r=this._getField(r.subFields,i),r))return r;return null},r.prototype.push=function(){for(var e,o,r,u=[],f=0;f<arguments.length;f++)u[+f]=arguments[f];for(e=this._ng,o=0;u&&o<u.length;o++){if(r=u[o],n.isString(r)&&(r=this==e.fields?new t.PivotField(e,r):e.fields.getField(r)),n.assert(r instanceof t.PivotField,'This collection must contain PivotField objects only.'),r.key&&this.getField(r.key))return n.assert(!1,'PivotField keys must be unique.'),-1;if(this._maxItems!=null&&this.length>=this._maxItems)break;i.prototype.push.call(this,r)}return this.length},r}(n.collections.ObservableArray);t.PivotFieldCollection=i})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={})),function(n){var t;(function(t){'use strict';var i=function(){function t(t){this._fld=t;var i=t;this._valueFilter=new n.grid.filter.ValueFilter(i);this._conditionFilter=new n.grid.filter.ConditionFilter(i)}return Object.defineProperty(t.prototype,"filterType",{get:function(){return this._filterType!=null?this._filterType:this._fld.engine.defaultFilterType},set:function(t){t!=this._filterType&&(this._filterType=n.asEnum(t,n.grid.filter.FilterType,!0),this.clear())},enumerable:!0,configurable:!0}),t.prototype.apply=function(n){return this._conditionFilter.apply(n)&&this._valueFilter.apply(n)},Object.defineProperty(t.prototype,"isActive",{get:function(){return this._conditionFilter.isActive||this._valueFilter.isActive},enumerable:!0,configurable:!0}),t.prototype.clear=function(){var t=!1;if(this._valueFilter.isActive&&(this._valueFilter.clear(),t=!0),this._conditionFilter.isActive&&(this._valueFilter.clear(),t=!0),t)this._fld.onPropertyChanged(new n.PropertyChangedEventArgs('filter',null,null))},Object.defineProperty(t.prototype,"valueFilter",{get:function(){return this._valueFilter},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"conditionFilter",{get:function(){return this._conditionFilter},enumerable:!0,configurable:!0}),t}();t.PivotFilter=i})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';n.culture.olap=n.culture.olap||{};n.culture.olap.PivotFieldEditor=window.wijmo.culture.olap.PivotFieldEditor||{dialogHeader:'Field settings:',header:'Header:',summary:'Summary:',showAs:'Show As:',weighBy:'Weigh by:',sort:'Sort:',filter:'Filter:',format:'Format:',sample:'Sample:',edit:'Edit...',clear:'Clear',ok:'OK',cancel:'Cancel',none:'(none)',sorts:{asc:'Ascending',desc:'Descending'},aggs:{sum:'Sum',cnt:'Count',avg:'Average',max:'Max',min:'Min',rng:'Range',std:'StdDev',var:'Var',stdp:'StdDevPop',varp:'VarPop'},calcs:{noCalc:'No calculation',dRow:'Difference from previous row',dRowPct:'% Difference from previous row',dCol:'Difference from previous column',dColPct:'% Difference from previous column',dPctGrand:'% of grand total',dPctRow:'% of row total',dPctCol:'% of column total',dRunTot:'Running total',dRunTotPct:'% running total'},formats:{n0:'Integer (n0)',n2:'Float (n2)',c:'Currency (c)',p0:'Percentage (p0)',p2:'Percentage (p2)',n2c:'Thousands (n2,)',n2cc:'Millions (n2,,)',n2ccc:'Billions (n2,,,)',d:'Date (d)',MMMMddyyyy:'Month Day Year (MMMM dd, yyyy)',dMyy:'Day Month Year (d/M/yy)',ddMyy:'Day Month Year (dd/M/yy)',dMyyyy:'Day Month Year (dd/M/yyyy)',MMMyyyy:'Month Year (MMM yyyy)',MMMMyyyy:'Month Year (MMMM yyyy)',yyyy:'Year (yyyy)',yyyyQq:'Year Quarter (yyyy "Q"q)',FYEEEEQU:'Fiscal Year Quarter ("FY"EEEE "Q"U)'}};var i=function(i){function r(t,r){var f=this,e,o,u;i.call(this,t,null,!0);e='Missing dependency: PivotFieldEditor requires ';n.assert(n.input!=null,e+'wijmo.input.');this._pvDate=new Date;o=this.getTemplate();this.applyTemplate('wj-control wj-content wj-pivotfieldeditor',o,{_dBnd:'sp-bnd',_dHdr:'div-hdr',_dAgg:'div-agg',_dShw:'div-shw',_dWFl:'div-wfl',_dSrt:'div-srt',_btnFltEdt:'btn-flt-edt',_btnFltClr:'btn-flt-clr',_dFmt:'div-fmt',_dSmp:'div-smp',_btnApply:'btn-apply',_btnCancel:'btn-cancel',_gDlg:'g-dlg',_gHdr:'g-hdr',_gAgg:'g-agg',_gShw:'g-shw',_gWfl:'g-wfl',_gSrt:'g-srt',_gFlt:'g-flt',_gFmt:'g-fmt',_gSmp:'g-smp'});u=n.culture.olap.PivotFieldEditor;this._gDlg.textContent=u.dialogHeader;this._gHdr.textContent=u.header;this._gAgg.textContent=u.summary;this._gShw.textContent=u.showAs;this._gWfl.textContent=u.weighBy;this._gSrt.textContent=u.sort;this._gFlt.textContent=u.filter;this._gFmt.textContent=u.format;this._gSmp.textContent=u.sample;this._btnFltEdt.textContent=u.edit;this._btnFltClr.textContent=u.clear;this._btnApply.textContent=u.ok;this._btnCancel.textContent=u.cancel;this._cmbHdr=new n.input.ComboBox(this._dHdr);this._cmbAgg=new n.input.ComboBox(this._dAgg);this._cmbShw=new n.input.ComboBox(this._dShw);this._cmbWFl=new n.input.ComboBox(this._dWFl);this._cmbSrt=new n.input.ComboBox(this._dSrt);this._cmbFmt=new n.input.ComboBox(this._dFmt);this._cmbSmp=new n.input.ComboBox(this._dSmp);this._initAggregateOptions();this._initShowAsOptions();this._initFormatOptions();this._initSortOptions();this._cmbShw.textChanged.addHandler(this._updateFormat,this);this._cmbFmt.textChanged.addHandler(this._updatePreview,this);this.addEventListener(this._btnFltEdt,'click',function(n){f._editFilter();n.preventDefault()});this.addEventListener(this._btnFltClr,'click',function(t){n.enable(f._btnFltClr,!1);f._createFilterEditor();setTimeout(function(){f._eFlt.clearEditor()});t.preventDefault()});this.addEventListener(this._btnApply,'click',function(){f.updateField()});this.initialize(r)}return __extends(r,i),Object.defineProperty(r.prototype,"field",{get:function(){return this._fld},set:function(i){i!=this._fld&&(this._fld=n.asType(i,t.PivotField),this.updateEditor())},enumerable:!0,configurable:!0}),r.prototype.updateEditor=function(){if(this._fld){this._dBnd.textContent=this._fld.binding;this._cmbHdr.text=this._fld.header;this._cmbAgg.collectionView.refresh();this._cmbAgg.selectedValue=this._fld.aggregate;this._cmbSrt.selectedValue=this._fld.descending;this._cmbShw.selectedValue=this._fld.showAs;this._initWeighByOptions();n.enable(this._btnFltClr,this._fld.filter.isActive);this._cmbFmt.collectionView.refresh();this._cmbFmt.selectedValue=this._fld.format;this._cmbFmt.selectedValue||(this._cmbFmt.text=this._fld.format);var i=this._fld instanceof t.CubePivotField;this._cmbAgg.isDisabled=i;this._cmbWFl.isDisabled=i}},r.prototype.updateField=function(){if(this._fld){var t=this._cmbHdr.text.trim();this._fld.header=t?t:n.toHeaderCase(this._fld.binding);this._fld.aggregate=this._cmbAgg.selectedValue;this._fld.showAs=this._cmbShw.selectedValue;this._fld.weightField=this._cmbWFl.selectedValue;this._fld.descending=this._cmbSrt.selectedValue;this._eFlt&&this._eFlt.updateFilter();this._fld.format=this._cmbFmt.selectedValue||this._cmbFmt.text}},r.prototype.containsFocus=function(){return i.prototype.containsFocus.call(this)||n.contains(this._dFlt,n.getActiveElement())},r.prototype._initAggregateOptions=function(){var i=this,t=n.culture.olap.PivotFieldEditor.aggs,r=[{key:t.sum,val:n.Aggregate.Sum,all:!1},{key:t.cnt,val:n.Aggregate.Cnt,all:!0},{key:t.avg,val:n.Aggregate.Avg,all:!1},{key:t.max,val:n.Aggregate.Max,all:!0},{key:t.min,val:n.Aggregate.Min,all:!0},{key:t.rng,val:n.Aggregate.Rng,all:!1},{key:t.std,val:n.Aggregate.Std,all:!1},{key:t.var,val:n.Aggregate.Var,all:!1},{key:t.stdp,val:n.Aggregate.StdPop,all:!1},{key:t.varp,val:n.Aggregate.VarPop,all:!1}];this._cmbAgg.itemsSource=r;this._cmbAgg.collectionView.filter=function(t){return t&&t.all?!0:i._fld?i._fld.dataType==n.DataType.Number||i._fld.dataType==n.DataType.Boolean:!1};this._cmbAgg.initialize({displayMemberPath:'key',selectedValuePath:'val'})},r.prototype._initShowAsOptions=function(){var i=n.culture.olap.PivotFieldEditor.calcs,r=[{key:i.noCalc,val:t.ShowAs.NoCalculation},{key:i.dRow,val:t.ShowAs.DiffRow},{key:i.dRowPct,val:t.ShowAs.DiffRowPct},{key:i.dCol,val:t.ShowAs.DiffCol},{key:i.dColPct,val:t.ShowAs.DiffColPct},{key:i.dPctGrand,val:t.ShowAs.PctGrand},{key:i.dPctRow,val:t.ShowAs.PctRow},{key:i.dPctCol,val:t.ShowAs.PctCol},{key:i.dRunTot,val:t.ShowAs.RunTot},{key:i.dRunTotPct,val:t.ShowAs.RunTotPct}];this._cmbShw.itemsSource=r;this._cmbShw.initialize({displayMemberPath:'key',selectedValuePath:'val'})},r.prototype._initFormatOptions=function(){var i=this,t=n.culture.olap.PivotFieldEditor.formats,r=[{key:t.n0,val:'n0',all:!0},{key:t.n2,val:'n2',all:!0},{key:t.c,val:'c',all:!0},{key:t.p0,val:'p0',all:!0},{key:t.p2,val:'p2',all:!0},{key:t.n2c,val:'n2,',all:!0},{key:t.n2cc,val:'n2,,',all:!0},{key:t.n2ccc,val:'n2,,,',all:!0},{key:t.d,val:'d',all:!1},{key:t.MMMMddyyyy,val:'MMMM dd, yyyy',all:!1},{key:t.dMyy,val:'d/M/yy',all:!1},{key:t.ddMyy,val:'dd/M/yy',all:!1},{key:t.ddMyyyy,val:'dd/M/yyyy',all:!1},{key:t.MMMyyyy,val:'MMM yyyy',all:!1},{key:t.MMMMyyyy,val:'MMMM yyyy',all:!1},{key:t.yyyy,val:'yyyy',all:!1},{key:t.yyyyQq,val:'yyyy "Q"q',all:!1},{key:t.FYEEEEQU,val:'"FY"EEEE "Q"U',all:!1}];this._cmbFmt.itemsSource=r;this._cmbFmt.isEditable=!0;this._cmbFmt.isRequired=!1;this._cmbFmt.collectionView.filter=function(t){return t&&t.all?!0:i._fld?i._fld.dataType==n.DataType.Date:!1};this._cmbFmt.initialize({displayMemberPath:'key',selectedValuePath:'val'})},r.prototype._initWeighByOptions=function(){var u=[{key:n.culture.olap.PivotFieldEditor.none,val:null}],r,i,t;if(this._fld)for(r=this._fld.engine,i=0;i<r.fields.length;i++)t=r.fields[i],t!=this._fld&&t.dataType==n.DataType.Number&&u.push({key:t.header,val:t});this._cmbWFl.initialize({displayMemberPath:'key',selectedValuePath:'val',itemsSource:u,selectedValue:this._fld.weightField})},r.prototype._initSortOptions=function(){var t=n.culture.olap.PivotFieldEditor.sorts,i=[{key:t.asc,val:!1},{key:t.desc,val:!0}];this._cmbSrt.itemsSource=i;this._cmbSrt.initialize({displayMemberPath:'key',selectedValuePath:'val'})},r.prototype._updateFormat=function(){switch(this._cmbShw.selectedValue){case t.ShowAs.DiffRowPct:case t.ShowAs.DiffColPct:this._cmbFmt.selectedValue='p0';break;default:this._cmbFmt.selectedValue='n0'}},r.prototype._updatePreview=function(){var t=this._cmbFmt.selectedValue||this._cmbFmt.text,r='',i,u;t&&(i=t[0].toLowerCase(),u='nfgxc',r=u.indexOf(i)>-1?n.Globalize.format(123.456,t):i=='p'?n.Globalize.format(.1234,t):n.Globalize.format(this._pvDate,t));this._cmbSmp.text=r},r.prototype._editFilter=function(){this._createFilterEditor();n.showPopup(this._dFlt,this._btnFltEdt,!1,!1,!1);n.moveFocus(this._dFlt,0)},r.prototype._createFilterEditor=function(){var i=this;this._dFlt||(this._dFlt=document.createElement('div'),this._eFlt=new t.PivotFilterEditor(this._dFlt,this._fld),n.addClass(this._dFlt,'wj-dropdown-panel'),this._eFlt.lostFocus.addHandler(function(){setTimeout(function(){var t=n.Control.getControl(i._dFlt);t&&!t.containsFocus()&&i._closeFilter()},10)}),this._eFlt.finishEditing.addHandler(function(){i._closeFilter();n.enable(i._btnFltClr,!0)}))},r.prototype._closeFilter=function(){this._dFlt&&(n.hidePopup(this._dFlt,!0),this.focus())},r.controlTemplate='<div><div class="wj-dialog-header"><span wj-part="g-dlg"><\/span> <span wj-part="sp-bnd"><\/span><\/div><div class="wj-dialog-body"><table cellspacing="0" cellpadding="5" style="table-layout:fixed"><tr><td wj-part="g-hdr"><\/td><td><div wj-part="div-hdr"><\/div><\/td><\/tr><tr class="wj-separator"><td wj-part="g-agg"><\/td><td><div wj-part="div-agg"><\/div><\/td><\/tr><tr class="wj-separator"><td wj-part="g-shw"><\/td><td><div wj-part="div-shw"><\/div><\/td><\/tr><tr><td wj-part="g-wfl"><\/td><td><div wj-part="div-wfl"><\/div><\/td><\/tr><tr><td wj-part="g-srt"><\/td><td><div wj-part="div-srt"><\/div><\/td><\/tr><tr class="wj-separator"><td wj-part="g-flt"><\/td><td><a wj-part="btn-flt-edt" href= "" draggable="false"><\/a>&nbsp;&nbsp;<a wj-part="btn-flt-clr" href= "" draggable="false"><\/a><\/td><\/tr><tr class="wj-separator"><td wj-part="g-fmt"><\/td><td><div wj-part="div-fmt"><\/div><\/td><\/tr><tr><td wj-part="g-smp"><\/td><td><div wj-part="div-smp" readonly disabled tabindex="-1"><\/div><\/td><\/tr><\/table><\/div><div class="wj-dialog-footer"><a class="wj-hide md-button" wj-part="btn-apply" href="" draggable="false"><\/a>&nbsp;&nbsp;<a class="wj-hide md-button" wj-part="btn-cancel" href="" draggable="false"><\/a><\/div><\/div>',r}(n.Control);t.PivotFieldEditor=i})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';var i=function(t){function i(i,r,u){var e=this,o,f;t.call(this,i);this.finishEditing=new n.Event;o=this.getTemplate();this.applyTemplate('wj-control wj-pivotfiltereditor wj-content',o,{_divType:'div-type',_aVal:'a-val',_aCnd:'a-cnd',_divEdtVal:'div-edt-val',_divEdtCnd:'div-edt-cnd',_btnOk:'btn-ok'});this._aVal.textContent=n.culture.FlexGridFilter.values;this._aCnd.textContent=n.culture.FlexGridFilter.conditions;this._btnOk.textContent=n.culture.olap.PivotFieldEditor.ok;f=this._btnClicked.bind(this);this._btnOk.addEventListener('click',f);this._aVal.addEventListener('click',f);this._aCnd.addEventListener('click',f);this.hostElement.addEventListener('keydown',function(t){switch(t.keyCode){case n.Key.Enter:switch(t.target.tagName){case'A':case'BUTTON':e._btnClicked(t);break;default:e.onFinishEditing(new n.CancelEventArgs)}t.preventDefault();break;case n.Key.Escape:e.onFinishEditing(new n.CancelEventArgs);t.preventDefault()}});this._fld=r;this.initialize(u);this.updateEditor()}return __extends(i,t),Object.defineProperty(i.prototype,"field",{get:function(){return this._fld},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"filter",{get:function(){return this._fld?this._fld.filter:null},enumerable:!0,configurable:!0}),i.prototype.updateEditor=function(){var t=n.grid.filter.FilterType.None;this.filter&&(t=this.filter.conditionFilter.isActive||(this.filter.filterType&n.grid.filter.FilterType.Value)==0?n.grid.filter.FilterType.Condition:n.grid.filter.FilterType.Value,this._showFilter(t));this._edtVal&&this._edtVal.updateEditor();this._edtCnd&&this._edtCnd.updateEditor()},i.prototype.updateFilter=function(){switch(this._getFilterType()){case n.grid.filter.FilterType.Value:this._edtVal.updateFilter();this.filter.conditionFilter.clear();break;case n.grid.filter.FilterType.Condition:this._edtCnd.updateFilter();this.filter.valueFilter.clear()}this.field.onPropertyChanged(new n.PropertyChangedEventArgs('filter',null,null))},i.prototype.clearEditor=function(){this._edtVal&&this._edtVal.clearEditor();this._edtCnd&&this._edtCnd.clearEditor()},i.prototype.onFinishEditing=function(n){return this.finishEditing.raise(this,n),!n.cancel},i.prototype._showFilter=function(t){t==n.grid.filter.FilterType.Value&&this._edtVal==null&&(this._edtVal=new n.grid.filter.ValueFilterEditor(this._divEdtVal,this.filter.valueFilter));t==n.grid.filter.FilterType.Condition&&this._edtCnd==null&&(this._edtCnd=new n.grid.filter.ConditionFilterEditor(this._divEdtCnd,this.filter.conditionFilter));(t&this.filter.filterType)!=0&&(t==n.grid.filter.FilterType.Value?(this._divEdtVal.style.display='',this._divEdtCnd.style.display='none',this._enableLink(this._aVal,!1),this._enableLink(this._aCnd,!0)):(this._divEdtVal.style.display='none',this._divEdtCnd.style.display='',this._enableLink(this._aVal,!0),this._enableLink(this._aCnd,!1)));switch(this.filter.filterType){case n.grid.filter.FilterType.None:case n.grid.filter.FilterType.Condition:case n.grid.filter.FilterType.Value:this._divType.style.display='none';break;default:this._divType.style.display=''}},i.prototype._enableLink=function(t,i){t.style.textDecoration=i?'':'none';t.style.fontWeight=i?'':'bold';n.setAttribute(t,'href',i?'':null)},i.prototype._getFilterType=function(){return this._divEdtVal.style.display!='none'?n.grid.filter.FilterType.Value:n.grid.filter.FilterType.Condition},i.prototype._btnClicked=function(t){if(t.preventDefault(),t.stopPropagation(),!n.hasClass(t.target,'wj-state-disabled')){if(t.target==this._aVal){this._showFilter(n.grid.filter.FilterType.Value);n.moveFocus(this._edtVal.hostElement,0);return}if(t.target==this._aCnd){this._showFilter(n.grid.filter.FilterType.Condition);n.moveFocus(this._edtCnd.hostElement,0);return}this.onFinishEditing(new n.CancelEventArgs)}},i.controlTemplate='<div><div wj-part="div-type" style="text-align:center;margin-bottom:12px;font-size:80%"><a wj-part="a-cnd" href="" tabindex="-1" draggable="false"><\/a>&nbsp;|&nbsp;<a wj-part="a-val" href="" tabindex="-1" draggable="false"><\/a><\/div><div wj-part="div-edt-val"><\/div><div wj-part="div-edt-cnd"><\/div><div style="text-align:right;margin-top:10px"><a wj-part="btn-ok" href="" tabindex="-1" draggable="false"><\/a><\/div>',i}(n.Control);t.PivotFilterEditor=i})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';var r,i,f,u;n.culture.olap=n.culture.olap||{};n.culture.olap.PivotEngine=window.wijmo.culture.olap.PivotEngine||{grandTotal:'Grand Total',subTotal:'Subtotal'},function(n){n[n.None=0]="None";n[n.GrandTotals=1]="GrandTotals";n[n.Subtotals=2]="Subtotals"}(t.ShowTotals||(t.ShowTotals={}));r=t.ShowTotals,function(n){n[n.NoCalculation=0]="NoCalculation";n[n.DiffRow=1]="DiffRow";n[n.DiffRowPct=2]="DiffRowPct";n[n.DiffCol=3]="DiffCol";n[n.DiffColPct=4]="DiffColPct";n[n.PctGrand=5]="PctGrand";n[n.PctRow=6]="PctRow";n[n.PctCol=7]="PctCol";n[n.RunTot=8]="RunTot";n[n.RunTotPct=9]="RunTotPct"}(t.ShowAs||(t.ShowAs={}));i=t.ShowAs;f=function(){function f(i){var f,u;for(this._autoGenFields=!0,this._allowFieldEditing=!0,this._showRowTotals=r.GrandTotals,this._showColTotals=r.GrandTotals,this._updating=0,this._cntTotal=0,this._cntFiltered=0,this._async=!0,this.itemsSourceChanged=new n.Event,this.viewDefinitionChanged=new n.Event,this.updatingView=new n.Event,this.updatedView=new n.Event,this.error=new n.Event,this._pivotView=new t.PivotCollectionView(this),this._fields=new t.PivotFieldCollection(this),this._rowFields=new t.PivotFieldCollection(this),this._columnFields=new t.PivotFieldCollection(this),this._valueFields=new t.PivotFieldCollection(this),this._filterFields=new t.PivotFieldCollection(this),this._viewLists=[this._rowFields,this._columnFields,this._valueFields,this._filterFields],f=this._fieldListChanged.bind(this),this._fields.collectionChanged.addHandler(f),u=0;u<this._viewLists.length;u++)this._viewLists[u].collectionChanged.addHandler(f);this._defaultFilterType=null;i&&n.copy(this,i)}return Object.defineProperty(f.prototype,"itemsSource",{get:function(){return this._items},set:function(i){var r=this;this._items!=i&&(this._cv&&(this._cv.collectionChanged.removeHandler(this._cvCollectionChanged,this),this._cv=null),this._server&&(this._server.clearPendingRequests(),this._server=null),this._items=i,n.isString(i)?this._server=new t._ServerConnection(this,i):this._cv=n.asCollectionView(i),this._cv!=null&&this._cv.collectionChanged.addHandler(this._cvCollectionChanged,this),this.deferUpdate(function(){r.autoGenerateFields&&r._generateFields()}),this.onItemsSourceChanged())},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"collectionView",{get:function(){return this._cv},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"pivotView",{get:function(){return this._pivotView},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"showRowTotals",{get:function(){return this._showRowTotals},set:function(t){t!=this.showRowTotals&&(this._showRowTotals=n.asEnum(t,r),this.onViewDefinitionChanged(),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"showColumnTotals",{get:function(){return this._showColTotals},set:function(t){t!=this.showColumnTotals&&(this._showColTotals=n.asEnum(t,r),this.onViewDefinitionChanged(),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"totalsBeforeData",{get:function(){return this._totalsBefore},set:function(t){t!=this._totalsBefore&&(this._totalsBefore=n.asBoolean(t),this.onViewDefinitionChanged(),this._updatePivotView())},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"showZeros",{get:function(){return this._showZeros},set:function(t){t!=this._showZeros&&(this._showZeros=n.asBoolean(t),this.onViewDefinitionChanged(),this._updatePivotView())},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"defaultFilterType",{get:function(){return this._defaultFilterType!=null?this._defaultFilterType:this._server?n.grid.filter.FilterType.Condition:n.grid.filter.FilterType.Both},set:function(t){this._defaultFilterType=n.asEnum(t,n.grid.filter.FilterType)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"autoGenerateFields",{get:function(){return this._autoGenFields},set:function(t){this._autoGenFields=n.asBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"allowFieldEditing",{get:function(){return this._allowFieldEditing},set:function(t){this._allowFieldEditing=n.asBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"fields",{get:function(){return this._fields},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"rowFields",{get:function(){return this._rowFields},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"columnFields",{get:function(){return this._columnFields},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"filterFields",{get:function(){return this._filterFields},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"valueFields",{get:function(){return this._valueFields},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"viewDefinition",{get:function(){for(var n,t,r={showZeros:this.showZeros,showColumnTotals:this.showColumnTotals,showRowTotals:this.showRowTotals,defaultFilterType:this.defaultFilterType,totalsBeforeData:this.totalsBeforeData,fields:[],rowFields:this._getFieldCollectionProxy(this.rowFields),columnFields:this._getFieldCollectionProxy(this.columnFields),filterFields:this._getFieldCollectionProxy(this.filterFields),valueFields:this._getFieldCollectionProxy(this.valueFields)},i=0;i<this.fields.length;i++)n=this.fields[i],t={binding:n.binding,header:n.header,dataType:n.dataType,aggregate:n.aggregate,showAs:n.showAs,descending:n.descending,format:n.format,width:n.width,isContentHtml:n.isContentHtml},n.weightField&&(t.weightField=n.weightField._getName()),n.key&&(t.key=n.key),n.filter.isActive&&(t.filter=this._getFilterProxy(n)),r.fields.push(t);return JSON.stringify(r)},set:function(i){var r=this,u=JSON.parse(i);u&&this.deferUpdate(function(){var o,i,e;for(r._copyProps(r,u,f._props),r.fields.clear(),i=0;i<u.fields.length;i++)e=u.fields[i],o=new t.PivotField(r,e.binding,e.header),o._autoGenerated=!0,r._copyProps(o,e,t.PivotField._props),e.filter&&r._setFilterProxy(o,e.filter),r.fields.push(o);for(i=0;i<u.fields.length;i++)e=u.fields[i],n.isString(e.weightField)&&(r.fields[i].weightField=r.fields.getField(e.weightField));r._setFieldCollectionProxy(r.rowFields,u.rowFields);r._setFieldCollectionProxy(r.columnFields,u.columnFields);r._setFieldCollectionProxy(r.filterFields,u.filterFields);r._setFieldCollectionProxy(r.valueFields,u.valueFields)})},enumerable:!0,configurable:!0}),Object.defineProperty(f.prototype,"isViewDefined",{get:function(){return this._valueFields.length>0&&(this._rowFields.length>0||this._columnFields.length>0)},enumerable:!0,configurable:!0}),f.prototype.beginUpdate=function(){this.cancelPendingUpdates();this._updating++},f.prototype.endUpdate=function(){this._updating--;this._updating<=0&&(this.onViewDefinitionChanged(),this.refresh())},Object.defineProperty(f.prototype,"isUpdating",{get:function(){return this._updating>0},enumerable:!0,configurable:!0}),f.prototype.deferUpdate=function(n){try{this.beginUpdate();n()}finally{this.endUpdate()}},f.prototype.refresh=function(n){n===void 0&&(n=!1);(!this.isUpdating||n)&&this._updateView()},f.prototype.invalidate=function(){var n=this;this._toInv&&(this._toInv=clearTimeout(this._toInv));this.isUpdating||(this._toInv=setTimeout(function(){n.refresh()},10))},Object.defineProperty(f.prototype,"async",{get:function(){return this._async},set:function(t){t!=this._async&&(this.cancelPendingUpdates(),this._async=n.asBoolean(t))},enumerable:!0,configurable:!0}),f.prototype.cancelPendingUpdates=function(){this._toUpdateTallies&&(clearTimeout(this._toUpdateTallies),this._toUpdateTallies=null)},f.prototype.getDetail=function(n,i){var u=n?n[t._PivotKey._ROW_KEY_NAME]:null,f=this._getKey(i),e,o,r,n;if(this._server)return this._server.getDetail(u,f);for(e=this.collectionView.items,o=[],r=0;r<e.length;r++)n=e[r],this._applyFilter(n)&&(u==null||u.matchesItem(n))&&(f==null||f.matchesItem(n))&&o.push(n);return o},f.prototype.getDetailView=function(t,i){var r=this.getDetail(t,i);return new n.collections.CollectionView(r)},f.prototype.getKeys=function(n,i){var r=n?n[t._PivotKey._ROW_KEY_NAME]:null,u=this._getKey(i);return{rowKey:{fields:r.fieldNames,values:r.values},colKey:{fields:u.fieldNames,values:u.values}}},f.prototype.editField=function(i){if(this.allowFieldEditing){var r=new t.PivotFieldEditor(document.createElement('div'),{field:i}),u=new n.input.Popup(document.createElement('div'),{content:r.hostElement});u.show(!0)}},f.prototype.removeField=function(n){for(var i,r,t=0;t<this._viewLists.length;t++)if(i=this._viewLists[t],r=i.indexOf(n),r>-1){i.removeAt(r);return}},f.prototype.onItemsSourceChanged=function(n){this.itemsSourceChanged.raise(this,n)},f.prototype.onViewDefinitionChanged=function(n){this._updating||this.viewDefinitionChanged.raise(this,n)},f.prototype.onUpdatingView=function(n){this.updatingView.raise(this,n)},f.prototype.onUpdatedView=function(n){this.updatedView.raise(this,n)},f.prototype.onError=function(n){return this.error.raise(this,n),!n.cancel},f.prototype._copy=function(t,i){var u,r,f;switch(t){case'fields':for(this.fields.clear(),r=0;r<this._viewLists.length;r++)this._viewLists[r].clear();for(u=n.asArray(i),r=0;r<u.length;r++)f=this._createField(u[r],!1),this.fields.push(f);return!0;case'rowFields':case'columnFields':case'valueFields':case'filterFields':for(this[t].clear(),n.isArray(i)||(this[t].maxItems=i.maxItems,i=i.items),u=n.asArray(i),r=0;r<u.length;r++)f=this.fields.getField(u[r]),this[t].push(f);return!0}return!1},f.prototype._getKey=function(n){return this._keys[n]},f.prototype._getRowLevel=function(i){if(n.isNumber(i)){var r=this._pivotView.items[i];i=r?r[t._PivotKey._ROW_KEY_NAME]:null}return!i||i._fieldCount==this.rowFields.length?-1:i._fieldCount},f.prototype._getColLevel=function(i){return n.isNumber(i)&&(i=this._colBindings[i]),n.isString(i)&&(i=this._getKey(i)),n.assert(i==null||i instanceof t._PivotKey,'invalid parameter in call to _getColLevel'),!i||i._fieldCount==this.columnFields.length?-1:i._fieldCount},f.prototype._applyFilter=function(n){for(var r,i=this._activeFilterFields,t=0;t<i.length;t++)if(r=i[t].filter,!r.apply(n))return!1;return!0},f.prototype._updateView=function(){var f=this,i,n,r,t,u;if(this.cancelPendingUpdates(),this._cntTotal=this._cntFiltered=0,this._tallies={},this._keys={},this._activeFilterFields=[],this._server&&this.isViewDefined){this._server.getOutputView(function(n){f._server.updateTallies(n);f._updatePivotView()});return}for(i=this._viewLists,n=0;n<i.length;n++)for(r=i[n],t=0;t<r.length;t++)u=r[t],u.filter.isActive&&this._activeFilterFields.push(u);this.isViewDefined&&this._cv&&this._cv.items?(this._batchStart=Date.now(),this._updateTallies(this._cv.items,0)):this._updatePivotView()},f.prototype._updateTallies=function(n,i){for(var o,h,a,s,v=this,tt=n.length,it=new t._PivotNode(this._rowFields,0,null,-1,null),y=this._rowFields.length,rt=this._showRowTotals==r.None?y:0,ut=this._showRowTotals==r.GrandTotals?Math.max(1,y):1,p=this._columnFields.length,ft=this._showColTotals==r.None?p:0,et=this._showColTotals==r.GrandTotals?Math.max(1,p):1,ot=this._valueFields.length,e=i;e<tt;e++){if(this._async&&e-i>=f._BATCH_SIZE&&Date.now()-this._batchStart>f._BATCH_DELAY){this._toUpdateTallies=setTimeout(function(){v.onUpdatingView(new u(Math.round(e/n.length*100)));v._batchStart=Date.now();v._updateTallies(n,e)},f._BATCH_TIMEOUT);return}if(this._cntTotal++,o=n[e],!this._activeFilterFields.length||this._applyFilter(o))for(this._cntFiltered++,h=rt;h<=y;h+=ut,c=c.parent){var c=it.getNode(this._rowFields,h,null,-1,o),g=c.key,w=g.toString(),l=this._tallies[w];for(l||(this._keys[w]=g,this._tallies[w]=l={}),a=ft;a<=p;a+=et)for(s=0;s<ot;s++){var st=c.tree.getNode(this._columnFields,a,this._valueFields,s,o),nt=st.key,b=nt.toString(),k=l[b];k||(this._keys[b]=nt,k=l[b]=new t._Tally);var d=this._valueFields[s],ht=d._getValue(o,!1),ct=d._weightField?d._getWeight(o):null;k.add(ht,ct)}}}this._toUpdateTallies=null;this._updatePivotView()},f.prototype._updatePivotView=function(){var n=this;this._pivotView.deferUpdate(function(){var i,s,h,r,c,p,l,f,e,o;n.onUpdatingView(new u(100));i=n._pivotView.sourceCollection;i.length=0;s={};for(r in n._tallies)s[r]=!0;h={};for(r in n._tallies){c=n._tallies[r];for(p in c)h[p]=!0}for(l=n._getSortedKeys(s),f=n._getSortedKeys(h),e=0;e<l.length;e++){var w=l[e],c=n._tallies[w],a={};for(a[t._PivotKey._ROW_KEY_NAME]=n._getKey(w),o=0;o<f.length;o++){var v=f[o],b=c[v],k=n._getKey(v),y=b?b.getAggregate(k.aggregate):null;y!=0||n._showZeros||(y=null);a[v]=y}i.push(a)}n._colBindings=f;n._updateFieldValues(i);n._pivotView.sortDescriptions.clear();n.onUpdatedView()})},f.prototype._getSortedKeys=function(n){var t=this;return Object.keys(n).sort(function(n,i){return t._keys[n].compareTo(t._keys[i])})},f.prototype._updateFieldValues=function(t){for(var l,a,h,c,u,r,e,f,s=this.valueFields.length,o=0;o<s;o++){l=this.valueFields[o];switch(l.showAs){case i.RunTot:case i.RunTotPct:for(r=o;r<this._colBindings.length;r+=s){for(u=0;u<t.length;u++)e=t[u],f=this._colBindings[r],e[f]=this._getRunningTotal(t,u,r,l.showAs);if(l.showAs==i.RunTotPct)for(u=0;u<t.length;u++){var e=t[u],f=this._colBindings[r],v=e[f];n.isNumber(v)&&(a=this._getLastValueInRowGroup(t,u,r),a!=0&&(e[f]=v/a))}}break;case i.PctGrand:case i.PctCol:if(h=0,l.showAs==i.PctGrand)for(r=o;r<this._colBindings.length;r+=s)this._getColLevel(r)==-1&&(h+=this._getColTotal(t,r));for(r=o;r<this._colBindings.length;r+=s)for(l.showAs==i.PctCol&&(h=this._getColTotal(t,r)),f=this._colBindings[r],u=0;u<t.length;u++)e=t[u],c=e[f],n.isNumber(c)&&(e[f]=h!=0?c/h:null);break;case i.PctRow:for(u=0;u<t.length;u++){for(e=t[u],h=0,r=o;r<this._colBindings.length;r+=s)this._getColLevel(r)==-1&&(f=this._colBindings[r],c=e[f],n.isNumber(c)&&(h+=c));for(r=o;r<this._colBindings.length;r+=s)f=this._colBindings[r],c=e[f],n.isNumber(c)&&(e[f]=h!=0?c/h:null)}break;case i.DiffRow:case i.DiffRowPct:for(r=o;r<this._colBindings.length;r+=s)for(u=t.length-1;u>=0;u--)e=t[u],f=this._colBindings[r],e[f]=this._getRowDifference(t,u,r,l.showAs);break;case i.DiffCol:case i.DiffColPct:for(u=0;u<t.length;u++)for(r=this._colBindings.length-s+o;r>=0;r-=s)e=t[u],f=this._colBindings[r],e[f]=this._getColDifference(t,u,r,l.showAs)}}},f.prototype._getColTotal=function(t,i){for(var u,e=this._colBindings[i],f=0,r=0;r<t.length;r++)this._getRowLevel(r)==-1&&(u=t[r][e],n.isNumber(u)&&(f+=u));return f},f.prototype._getRunningTotal=function(n,t,i){var f=this._getRowLevel(t),u,o,c,l,a;if(f==0)return null;var s=this._colBindings[i],h=n[t][s],e=this.rowFields.length-2;for(u=t-1;u>=0;u--){if(o=this._getRowLevel(u),o==f){if(e>-1&&f<0&&this._showRowTotals!=r.Subtotals&&(c=n[t].$rowKey,l=n[u].$rowKey,c.values[e]!=l.values[e]))return null;a=n[u][s];h+=a;break}if(o>f)break}return h},f.prototype._getLastValueInRowGroup=function(n,t,i){for(var s,c,l,h=this._colBindings[i],f=n[t][h],e=this._getRowLevel(t),o=this.rowFields.length-2,u=t+1;u<n.length;u++){if(s=this._getRowLevel(u),s==e){if(o>-1&&e<0&&this._showRowTotals!=r.Subtotals&&(c=n[t].$rowKey,l=n[u].$rowKey,c.values[o]!=l.values[o]))return f;f=n[u][h]}if(s>e)break}return f},f.prototype._getRowDifference=function(n,t,u,f){var o=this._getRowLevel(t),s,e,h,c,l;if(o==0)return null;for(s=this.rowFields.length-2,e=t-1;e>=0;e--){if(h=this._getRowLevel(e),h==o){if(s>-1&&o<0&&this._showRowTotals!=r.Subtotals&&(c=n[t].$rowKey,l=n[e].$rowKey,c.values[s]!=l.values[s]))return null;var a=this._colBindings[u],p=n[t][a],v=n[e][a],y=p-v;return f==i.DiffRowPct&&(y/=v),y}if(h>o)break}return null},f.prototype._getColDifference=function(n,t,u,f){var o=this._getColLevel(u),h,s,e,c,l,a;if(o==0)return null;for(h=this.valueFields.length,s=this.columnFields.length-2,e=u-h;e>=0;e-=h){if(c=this._getColLevel(e),c==o){if(s>-1&&o<0&&this._showColTotals!=r.Subtotals&&(l=this._getKey(this._colBindings[u]),a=this._getKey(this._colBindings[e]),l.values[s]!=a.values[s]))return null;var v=n[t],w=v[this._colBindings[u]],y=v[this._colBindings[e]],p=w-y;return f==i.DiffColPct&&(p/=y),p}if(c>o)break}return null},f.prototype._generateFields=function(){for(var e,r,u,f,i,t=0;t<this._viewLists.length;t++)this._viewLists[t].clear();for(t=0;t<this.fields.length;t++)i=this.fields[t],i._autoGenerated&&(this.fields.removeAt(t),t--);if(this._server){for(e=this._server.getFields(),t=0;t<e.length;t++)i=this._createField(e[t],!0),this.fields.push(i);return}if(r=null,u=this.collectionView,u&&u.sourceCollection&&u.sourceCollection.length&&(r=u.sourceCollection[0]),r&&this.autoGenerateFields)for(f in r)n.isPrimitive(r[f])&&(i=this._createField({binding:f,header:n.toHeaderCase(f),dataType:n.getType(r[f])},!0),this.fields.push(i));if(r)for(t=0;t<this.fields.length;t++)i=this.fields[t],i.dataType==null&&i._binding&&(i.dataType=n.getType(i._binding.getValue(r)))},f.prototype._createField=function(i,r){var u;if(u=n.isString(i)?new t.PivotField(this,i):i.dimensionType!=null?new t.CubePivotField(this,i.binding,i.header,i):new t.PivotField(this,i.binding,i.header,i),u._autoGenerated=r,r||n.isString(i))switch(u.dataType){case n.DataType.Number:u.aggregate=n.Aggregate.Sum;u.format='n0';break;case n.DataType.Date:u.aggregate=n.Aggregate.Cnt;u.format='d';break;default:u.aggregate=n.Aggregate.Cnt}return u},f.prototype._cvCollectionChanged=function(){this.invalidate()},f.prototype._fieldListChanged=function(t,i){var r,e,u,o,f;if(i.action==n.collections.NotifyCollectionChangedAction.Add){for(r=t,u=0;u<r.length-1;u++)if(r[u].key)for(e=u+1;e<r.length;e++)r[u].key==r[e].key&&(r.removeAt(e),e--);if(r!=this._fields)if(this._fields.getField(i.item.key))for(u=0;u<this._viewLists.length;u++)this._viewLists[u]!=r&&(o=this._viewLists[u],f=o.indexOf(i.item),f>-1&&o.removeAt(f));else r.removeAt(i.index);if(n.isNumber(r.maxItems)&&r.maxItems>-1)while(r.length>r.maxItems)f=r.length-1,r[f]==i.item&&f>0&&f--,r.removeAt(f)}this.onViewDefinitionChanged();this.invalidate()},f.prototype._fieldPropertyChanged=function(n,t){if(this.onViewDefinitionChanged(),n.isActive){var i=t.propertyName;if(i=='width'||i=='wordWrap'||i=='isContentHtml'){this._pivotView.refresh();return}if(i=='format'&&this.valueFields.indexOf(n)>-1){this._pivotView.refresh();return}if(i=='showAs'){this.valueFields.indexOf(n)>-1&&!this.isUpdating&&this._updatePivotView();return}if(i=='descending'){this._updatePivotView();return}if(i=='aggregate'){this.valueFields.indexOf(n)>-1&&!this.isUpdating&&(this._server?this._updateView():this._updatePivotView());return}this.invalidate()}},f.prototype._copyProps=function(n,t,i){for(var u,r=0;r<i.length;r++)u=i[r],t[u]!=null&&(n[u]=t[u])},f.prototype._getFieldCollectionProxy=function(t){var r={items:[]},i,u;for(n.isNumber(t.maxItems)&&t.maxItems>-1&&(r.maxItems=t.maxItems),i=0;i<t.length;i++)u=t[i],r.items.push(u.key);return r},f.prototype._setFieldCollectionProxy=function(t,i){t.clear();t.maxItems=n.isNumber(i.maxItems)?i.maxItems:null;for(var r=0;r<i.items.length;r++)t.push(i.items[r])},f.prototype._getFilterProxy=function(t){var r=t.filter,i,u,f;return r.conditionFilter.isActive?(i=r.conditionFilter,u={type:'condition',condition1:{operator:i.condition1.operator,value:i.condition1.value},and:i.and,condition2:{operator:i.condition2.operator,value:i.condition2.value}},i.condition1.isActive||delete u.condition1,i.condition2.isActive||delete u.condition2,u):r.valueFilter.isActive?(f=r.valueFilter,{type:'value',filterText:f.filterText,showValues:f.showValues}):(n.assert(!1,'inactive filters shouldn\'t be persisted.'),null)},f.prototype._setFilterProxy=function(t,i){var f=t.filter,r,u,e;f.clear();switch(i.type){case'condition':r=f.conditionFilter;i.condition1&&(u=n.changeType(i.condition1.value,t.dataType,t.format),r.condition1.value=u?u:i.condition1.value,r.condition1.operator=i.condition1.operator);n.isBoolean(i.and)&&(r.and=i.and);i.condition2&&(u=n.changeType(i.condition2.value,t.dataType,t.format),r.condition2.value=u?u:i.condition2.value,r.condition2.operator=i.condition2.operator);break;case'value':e=f.valueFilter;e.filterText=i.filterText;e.showValues=i.showValues}},f._BATCH_SIZE=1e4,f._BATCH_TIMEOUT=0,f._BATCH_DELAY=100,f._props=['showZeros','showRowTotals','showColumnTotals','totalsBeforeData','defaultFilterType'],f}();t.PivotEngine=f;u=function(t){function i(i){t.call(this);this._progress=n.asNumber(i)}return __extends(i,t),Object.defineProperty(i.prototype,"progress",{get:function(){return this._progress},enumerable:!0,configurable:!0}),i}(n.EventArgs);t.ProgressEventArgs=u})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';var r=function(){function r(i,r){this._ng=n.asType(i,t.PivotEngine);n.assert(this._isValidUrl(r),'Invalid service Url: '+r+')')}return r.prototype.getFields=function(){var t=n.httpRequest(this._getUrl('Fields'),{async:!1}),i=JSON.parse(t.responseText);return n.isArray(i)?i:(console.error('Failed to get fields from server: '+t.responseText),null)},r.prototype.getOutputView=function(n){var t=this;this.clearPendingRequests();this._sendHttpRequest('Analyses',{method:'POST',data:{view:this._ng.viewDefinition},success:function(i){var r=JSON.parse(i.responseText);t._token=r.token;t._start=Date.now();t._handleResult(r.status,n)},error:function(n){t._handleError('Analyses',n)}})},r.prototype.getDetail=function(t,i){for(var e,f=[],o=this._ng.rowFields.length,s=t?t.values.length:0,u=0;u<o;u++)u<s?f.push(t.values[u]):f.push(null);for(o=this._ng.columnFields.length,s=i?i.values.length:0,u=0;u<o;u++)u<s?f.push(i.values[u]):f.push(null);return e=new n.collections.ObservableArray,this._loadArray('Detail',e,{method:'POST',view:this._ng.viewDefinition,keys:f,max:r._MAXDETAIL}),e},r.prototype.clearPendingRequests=function(){this._clearRequest();this._clearTimeout();this._clearToken()},r.prototype.updateTallies=function(n){var u=this,r=this._ng,f=r.rowFields.length,e=r.columnFields.length,o=r.valueFields.length,s=new t._PivotNode(r.rowFields,0,null,-1,null);n.forEach(function(n){var c=u._getAggregatedFieldCount(n,r.rowFields),y=s.getNode(r.rowFields,f-c,null,-1,n),p=y.key,l=p.toString(),h=r._tallies[l],t;for(h||(r._keys[l]=p,r._tallies[l]=h={}),c=u._getAggregatedFieldCount(n,r.columnFields),t=0;t<o;t++){var b=y.tree.getNode(r.columnFields,e-c,r.valueFields,t,n),w=b.key,a=w.toString(),v=h[a],k=r.valueFields[t];v||(r._keys[a]=w,v=h[a]=new i);v.add(u._getFieldValue(k,n,!1))}})},r.prototype._getFieldValue=function(t,i,r){var u=i[t.key];return!r||typeof u=='string'?u:n.Globalize.format(u,t.format)},r.prototype._getAggregatedFieldCount=function(n,t){for(var u,f=t.length,r=0,i=0;i<f;i++)u=t[i],this._getFieldValue(u,n,!1)==null&&r++;return r},r.prototype._loadArray=function(t,i,r){var u=this,f;r||(r={});r.skip==null&&(r.skip=0);r.top==null&&(r.top=100);f=n.isNumber(r.max)?r.max:1e6;n.httpRequest(this._getUrl(t),{data:r,method:r.method||'GET',success:function(n){var e=JSON.parse(n.responseText);i.deferUpdate(function(){e.value.forEach(function(n){i.push(n)})});e.value.length==r.top&&i.length<f&&(r.skip+=r.top,u._loadArray(t,i,r))},error:function(n){u._handleError(t,n)}})},r.prototype._getUrl=function(t,i,r){i===void 0&&(i=this._token);var u=this._ng.itemsSource.toString(),f=u.lastIndexOf('/'),e=u.substr(0,f);t=t.toLowerCase();switch(t){case'rawdata':case'detail':return u;case'fields':case'analyses':return u+'/'+t;case'clear':return u+'/analyses/'+i+'/';case'result':case'status':return u+'/analyses/'+i+'/'+t;case'uniquevalues':return u+'/fields/'+r+'/'+t}n.assert(!1,'Unrecognized command')},r.prototype._isValidUrl=function(t){var i=document.createElement('a');return i.href=n.asString(t),i.href=i.href,i.protocol&&i.hostname&&i.pathname&&t[t.length-1]!='/'},r.prototype._handleResult=function(i,u){var f=this;switch(i.executingStatus.toLowerCase()){case'executing':case'notset':if(Date.now()-this._start>r._TIMEOUT){this._clearToken();console.error('*** Connection timed out after '+r._TIMEOUT+'ms...');return}this._progress=i.progress;this._ng.onUpdatingView(new t.ProgressEventArgs(this._progress));this._clearTimeout();this._toGetStatus=setTimeout(function(){f._waitUntilComplete(u)},r._POLL_INTERVAL);break;case'completed':this._progress=100;this._ng.onUpdatingView(new t.ProgressEventArgs(this._progress));this._getResults(u);break;default:n.assert(!1,'Unexpected result...')}},r.prototype._waitUntilComplete=function(n){var t=this;this._sendHttpRequest('Status',{success:function(i){var r=JSON.parse(i.responseText);t._handleResult(r,n)},error:function(n){t._handleError('Status',n)}})},r.prototype._getResults=function(t){var i=this;this._sendHttpRequest('Result',{success:function(r){var u,f;i._clearToken();u=JSON.parse(r.responseText);n.assert(n.isArray(u),'Result array Expected.');f=i._ng.columnFields.filter(function(t){return t.dataType==n.DataType.Date}).concat(i._ng.rowFields.filter(function(t){return t.dataType==n.DataType.Date}));f.length>0&&u.forEach(function(t){f.forEach(function(i){var r=i._binding,u=r.getValue(t);n.isString(u)&&r.setValue(t,new Date(u))})});n.asFunction(t)(u)},error:function(n){i._handleError('Result',n)}})},r.prototype._handleError=function(t,i){if(t='** HttpRequest error on command "'+t+'"',this._ng.onError(new n.RequestErrorEventArgs(i,t)))throw t+'\r\n'+i.status+'\r\n'+i.statusText;},r.prototype._sendHttpRequest=function(t,i){var r=this._getUrl(t);this._request=n.httpRequest(r,i)},r.prototype._clearToken=function(){this._token&&(this._clearRequest(),this._clearTimeout(),this._sendHttpRequest('Clear',{method:'DELETE'}),this._token=null)},r.prototype._clearRequest=function(){this._request&&this._request.readyState!=4&&(this._request.abort(),this._request=null)},r.prototype._clearTimeout=function(){this._toGetStatus&&(clearTimeout(this._toGetStatus),this._toGetStatus=null)},r._POLL_INTERVAL=500,r._TIMEOUT=6e4,r._MAXDETAIL=1e3,r}(),i;t._ServerConnection=r;i=function(t){function i(){t.apply(this,arguments)}return __extends(i,t),i.prototype.add=function(i,r){n.assert(this._cnt==0,'Server tallies have a single value.');t.prototype.add.call(this,i,r)},i.prototype.getAggregate=function(){return this._sum},i}(t._Tally)})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';n.culture.olap=n.culture.olap||{};n.culture.olap._ListContextMenu=window.wijmo.culture.olap._ListContextMenu||{up:'Move Up',down:'Move Down',first:'Move to Beginning',last:'Move to End',filter:'Move to Report Filter',rows:'Move to Row Labels',cols:'Move to Column Labels',vals:'Move to Values',remove:'Remove Field',edit:'Field Settings...',detail:'Show Detail...'};var i=function(i){function r(t){var r=this;i.call(this,document.createElement('div'),{header:'Field Context Menu',displayMemberPath:'text',commandParameterPath:'parm',command:{executeCommand:function(n){r._execute(n)},canExecuteCommand:function(n){return r._canExecute(n)}}});this._full=t;this.itemsSource=this._getMenuItems(t);n.addClass(this.dropDown,'context-menu')}return __extends(r,i),r.prototype.refresh=function(n){n===void 0&&(n=!0);this.itemsSource=this._getMenuItems(this._full);i.prototype.refresh.call(this,n)},r.prototype.attach=function(t){var i=this,r;n.assert(t instanceof n.grid.FlexGrid,'Expecting a FlexGrid control...');r=t.hostElement;r.addEventListener('contextmenu',function(n){i._selectField(t,n)&&(n.preventDefault(),i.owner=r,i.show(n))})},r.prototype._selectField=function(n,i){var r=n.hitTest(i),u;return r.panel!=n.cells||!r.range.isValid?!1:(u=n.rows[r.row].dataItem,u instanceof t.CubePivotField&&u.subFields&&u.subFields.length)?!1:(n.select(r.range,!0),!0)},r.prototype._getMenuItems=function(t){for(var i,f,r=t?[{text:'<div class="menu-icon"></div>*',parm:'up'},{text:'<div class="menu-icon"></div>*',parm:'down'},{text:'<div class="menu-icon"></div>*',parm:'first'},{text:'<div class="menu-icon"></div>*',parm:'last'},{text:'<div class="wj-separator"></div>'},{text:'<div class="menu-icon"><span class="wj-glyph-filter"></span></div>*',parm:'filter'},{text:'<div class="menu-icon">&#8801;</div>*',parm:'rows'},{text:'<div class="menu-icon">&#10996;</div>*',parm:'cols'},{text:'<div class="menu-icon">&#931;</div>*',parm:'vals'},{text:'<div class="wj-separator"></div>'},{text:'<div class="menu-icon menu-icon-remove">&#10006;</div>*',parm:'remove'},{text:'<div class="wj-separator"></div>'},{text:'<div class="menu-icon">&#9965;</div>*',parm:'edit'}]:[{text:'<div class="menu-icon"><span class="wj-glyph-filter"></span></div>*',parm:'filter'},{text:'<div class="menu-icon">&#8801;</div>*',parm:'rows'},{text:'<div class="menu-icon">&#10996;</div>*',parm:'cols'},{text:'<div class="menu-icon">&#931;</div>*',parm:'vals'},{text:'<div class="wj-separator"></div>'},{text:'<div class="menu-icon">&#9965;</div>*',parm:'edit'}],u=0;u<r.length;u++)i=r[u],i.parm&&(f=n.culture.olap._ListContextMenu[i.parm],n.assert(f,'missing localized text for item '+i.parm),i.text=i.text.replace(/([^>]+$)/,f));return r},r.prototype._execute=function(t){var e=n.Control.getControl(this.owner),u=e.itemsSource,h=e.selection.row,i=e.rows[h].dataItem,r=i?i.engine:null,o=this._getTargetList(r,t),f,s;switch(t){case'up':case'first':case'down':case'last':r&&(f=u.indexOf(i),s=t=='up'?f-1:t=='first'?0:t=='down'?f+1:t=='last'?u.length:-1,r.deferUpdate(function(){u.removeAt(f);u.insert(s,i)}));break;case'filter':case'rows':case'cols':case'vals':o&&i&&o.push(i);break;case'remove':i&&r.removeField(i);break;case'edit':i&&r.editField(i)}},r.prototype._canExecute=function(i){var u=n.Control.getControl(this.owner),f=u.selection.row,r=u.rows[f].dataItem,e=r?r.engine:null,o=this._getTargetList(e,i);switch(i){case'up':case'first':return f>0;case'down':case'last':return f<u.rows.length-1;case'filter':case'rows':case'cols':case'vals':return o&&o.indexOf(r)<0;case'edit':return e&&e.allowFieldEditing;case'detail':return r&&!(r instanceof t.CubePivotField)}return!0},r.prototype._getTargetList=function(n,t){if(n)switch(t){case'filter':return n.filterFields;case'rows':return n.rowFields;case'cols':return n.columnFields;case'vals':return n.valueFields}return null},r}(n.input.Menu);t._ListContextMenu=i})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';n.culture.olap=n.culture.olap||{};n.culture.olap.PivotPanel=window.wijmo.culture.olap.PivotPanel||{fields:'Choose fields to add to report:',drag:'Drag fields between areas below:',filters:'Filters',cols:'Columns',rows:'Rows',vals:'Values',defer:'Defer Updates',update:'Update'};var i=function(i){function r(r,u){var e=this,s,h,o,f;i.call(this,r,null,!0);this.itemsSourceChanged=new n.Event;this.viewDefinitionChanged=new n.Event;this.updatingView=new n.Event;this.updatedView=new n.Event;s='Missing dependency: PivotPanel requires ';n.assert(n.input!=null,s+'wijmo.input.');n.assert(n.grid!=null&&n.grid.filter!=null,s+'wijmo.grid.filter.');h=this.getTemplate();this.applyTemplate('wj-control wj-content wj-pivotpanel',h,{_dFields:'d-fields',_dFilters:'d-filters',_dRows:'d-rows',_dCols:'d-cols',_dVals:'d-vals',_dProgress:'d-prog',_btnUpdate:'btn-update',_chkDefer:'chk-defer',_gFlds:'g-flds',_gDrag:'g-drag',_gFlt:'g-flt',_gCols:'g-cols',_gRows:'g-rows',_gVals:'g-vals',_gDefer:'g-defer'});this._globalize();o=this.hostElement;this.addEventListener(o,'dragstart',this._dragstart.bind(this));this.addEventListener(o,'dragover',this._dragover.bind(this));this.addEventListener(o,'dragleave',this._dragover.bind(this));this.addEventListener(o,'drop',this._drop.bind(this));this.addEventListener(o,'dragend',this._dragend.bind(this));this._lbFields=this._createFieldGrid(this._dFields);this._lbFilters=this._createFieldGrid(this._dFilters);this._lbRows=this._createFieldGrid(this._dRows);this._lbCols=this._createFieldGrid(this._dCols);this._lbVals=this._createFieldGrid(this._dVals);f=this._ctxMenuShort=new t._ListContextMenu(!1);f.attach(this._lbFields);f=this._ctxMenuFull=new t._ListContextMenu(!0);f.attach(this._lbFilters);f.attach(this._lbRows);f.attach(this._lbCols);f.attach(this._lbVals);this._dMarker=n.createElement('<div class="wj-marker" style="display:none">&nbsp;</div>');this.hostElement.appendChild(this._dMarker);this.addEventListener(this._btnUpdate,'click',function(n){e._ng.refresh(!0);n.preventDefault()});this.addEventListener(this._chkDefer,'click',function(){n.enable(e._btnUpdate,e._chkDefer.checked);e._chkDefer.checked?e._ng.beginUpdate():e._ng.endUpdate()});this.engine=new t.PivotEngine;this.initialize(u)}return __extends(r,i),Object.defineProperty(r.prototype,"engine",{get:function(){return this._ng},set:function(i){this._ng&&(this._ng.itemsSourceChanged.removeHandler(this._itemsSourceChanged),this._ng.viewDefinitionChanged.removeHandler(this._viewDefinitionChanged),this._ng.updatingView.removeHandler(this._updatingView),this._ng.updatedView.removeHandler(this._updatedView));i=n.asType(i,t.PivotEngine,!1);this._ng=i;this._ng.itemsSourceChanged.addHandler(this._itemsSourceChanged,this);this._ng.viewDefinitionChanged.addHandler(this._viewDefinitionChanged,this);this._ng.updatingView.addHandler(this._updatingView,this);this._ng.updatedView.addHandler(this._updatedView,this);this._lbFields.itemsSource=i.fields;this._lbFilters.itemsSource=i.filterFields;this._lbRows.itemsSource=i.rowFields;this._lbCols.itemsSource=i.columnFields;this._lbVals.itemsSource=i.valueFields;this._lbFields.collectionView.filter=function(n){return n.parentField==null}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"itemsSource",{get:function(){return this._ng.itemsSource},set:function(n){this._ng.itemsSource=n},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"collectionView",{get:function(){return this._ng.collectionView},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"pivotView",{get:function(){return this._ng.pivotView},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"autoGenerateFields",{get:function(){return this.engine.autoGenerateFields},set:function(n){this._ng.autoGenerateFields=n},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"fields",{get:function(){return this._ng.fields},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"rowFields",{get:function(){return this._ng.rowFields},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"columnFields",{get:function(){return this._ng.columnFields},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"valueFields",{get:function(){return this._ng.valueFields},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"filterFields",{get:function(){return this._ng.filterFields},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"viewDefinition",{get:function(){return this._ng.viewDefinition},set:function(n){this._ng.viewDefinition=n},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isViewDefined",{get:function(){return this._ng.isViewDefined},enumerable:!0,configurable:!0}),r.prototype.onItemsSourceChanged=function(n){this.itemsSourceChanged.raise(this,n)},r.prototype.onViewDefinitionChanged=function(n){this.viewDefinitionChanged.raise(this,n)},r.prototype.onUpdatingView=function(n){this.updatingView.raise(this,n)},r.prototype.onUpdatedView=function(n){this.updatedView.raise(this,n)},r.prototype.refresh=function(n){n===void 0&&(n=!0);this._lbFields.refresh();this._lbFilters.refresh();this._lbRows.refresh();this._lbCols.refresh();this._lbVals.refresh();n&&(this._globalize(),this._ctxMenuShort.refresh(),this._ctxMenuFull.refresh());i.prototype.refresh.call(this,n)},r.prototype._copy=function(n,t){switch(n){case'engine':return this.engine=t,!0}return!1},r.prototype._globalize=function(){var t=n.culture.olap.PivotPanel;this._gFlds.textContent=t.fields;this._gDrag.textContent=t.drag;this._gFlt.textContent=t.filters;this._gCols.textContent=t.cols;this._gRows.textContent=t.rows;this._gVals.textContent=t.vals;this._gDefer.textContent=t.defer;this._btnUpdate.textContent=t.update},r.prototype._itemsSourceChanged=function(n,t){this.onItemsSourceChanged(t)},r.prototype._viewDefinitionChanged=function(n,t){if(!n.isUpdating){this.invalidate();this.onViewDefinitionChanged(t)}},r.prototype._updatingView=function(t,i){var r=n.clamp(i.progress,5,100)%100;this._dProgress.style.width=r+'%';this.onUpdatingView(i)},r.prototype._updatedView=function(n,t){this.onUpdatedView(t)},r.prototype._createFieldGrid=function(i){var u=this,r=new n.grid.FlexGrid(i,{autoGenerateColumns:!1,childItemsPath:'subFields',columns:[{binding:'header',width:'*'}],headersVisibility:'None',selectionMode:'Cell',showAlternatingRows:!1}),f=i.querySelector('[wj-part=root]');return f.style.overflowX='hidden',r.formatItem.addHandler(function(i,r){var f=i.rows[r.row].dataItem,o,e;n.assert(f instanceof t.PivotField,'PivotField expected...');o=f instanceof t.CubePivotField&&f.subFields!=null&&f.subFields.length>0;n.toggleClass(r.cell,'wj-header',o);r.cell.setAttribute('draggable',(!o).toString());e=r.cell.innerHTML;f.filter.isActive&&(e+='&nbsp;&nbsp;<span class="wj-glyph-filter"></span>');i==u._lbVals&&(e+=' <span class="wj-aggregate">('+n.Aggregate[f.aggregate]+')</span>');i!=u._lbFields||o||(e='<label><input type="checkbox"'+(f.isActive?' checked':'')+'> '+e+'</label>');r.cell.innerHTML=e}),r.addEventListener(i,'click',function(n){var i=n.target,u;i instanceof HTMLInputElement&&i.type=='checkbox'&&(u=r.collectionView.currentItem,u instanceof t.PivotField&&(u.isActive=i.checked))}),r},r.prototype._dragstart=function(i){var r=this._getFlexGridTarget(i);r&&(this._dragField=this._hitTestField(r,i),this._dragSource=this._dragField instanceof t.PivotField?r.hostElement:null,this._dragSource&&i.dataTransfer&&(n._startDrag(i.dataTransfer,'copyMove'),i.stopPropagation()))},r.prototype._dragover=function(n){var r=!1,i=this._getFlexGridTarget(n),u,f;i&&this._dragField&&(this._dragSource==this._dFields&&i!=this._lbFields&&(u=i.itemsSource,(u.maxItems==null||u.length<u.maxItems)&&(f=this._dragField,i.itemsSource.indexOf(f)<0?r=!0:i==this._lbVals&&(r=f instanceof t.CubePivotField?!1:!0))),this._dragSource&&this._dragSource!=this._dFields&&(r=!0));r?(this._updateDropMarker(i,n),n.dataTransfer.dropEffect=this._dragSource==this._dFields?'copy':'move',n.preventDefault(),n.stopPropagation()):this._updateDropMarker()},r.prototype._drop=function(t){var u=this,r=this._getFlexGridTarget(t),f,i;r&&this._dragField&&(f=n.Control.getControl(this._dragSource),i=this._dragField,f==this._lbFields&&r==this._lbVals&&r.itemsSource.indexOf(i)>-1&&(i=i._clone(),this.engine.fields.push(i)),r==this._lbFields?i.isActive=!1:this._ng.deferUpdate(function(){var t=r.itemsSource,n=t.indexOf(i);n!=u._dropIndex&&(n>-1&&(t.removeAt(n),n<u._dropIndex&&u._dropIndex--),t.insert(u._dropIndex,i))}));this._resetMouseState()},r.prototype._dragend=function(){this._resetMouseState()},r.prototype._hitTestField=function(n,t){var i=n.hitTest(t);return i.panel==n.cells&&i.range.isValid?(n.select(i.range,!0),n.rows[i.row].dataItem):null},r.prototype._resetMouseState=function(){this._dragSource=null;this._updateDropMarker()},r.prototype._getFlexGridTarget=function(t){var i=n.Control.getControl(n.closest(t.target,'.wj-flexgrid'));return i instanceof n.grid.FlexGrid?i:null},r.prototype._updateDropMarker=function(t,i){var r,f,u,e;if(!i){this._dMarker.style.display='none';return}t.rows.length?(f=t.hitTest(i),u=f.row,u>-1?(r=t.getCellBoundingRect(u,0),f.point.y>r.top+r.height/2&&(r.top+=r.height,u++),this._dropIndex=u):(u=t.viewRange.bottomRow,r=t.getCellBoundingRect(u,0),r.top+=r.height,this._dropIndex=u+1)):(r=n.Rect.fromBoundingRect(t.hostElement.getBoundingClientRect()),r.top+=4,this._dropIndex=0);e=this.hostElement.getBoundingClientRect();n.setCss(this._dMarker,{left:Math.round(r.left-e.left),top:Math.round(r.top-e.top-2),width:Math.round(r.width),height:4,display:''})},r.controlTemplate='<div><label wj-part="g-flds"><\/label><div wj-part="d-fields"><\/div><label wj-part="g-drag"><\/label><table><tr><td width="50%"><label><span class="wj-glyph wj-glyph-filter"><\/span> <span wj-part="g-flt"><\/span><\/label><div wj-part="d-filters"><\/div><\/td><td width= "50%" style= "border-left-style:solid"><label><span class="wj-glyph">&#10996;<\/span> <span wj-part="g-cols"><\/span><\/label><div wj-part="d-cols"><\/div><\/td><\/tr><tr style= "border-top-style:solid"><td width="50%"><label><span class="wj-glyph">&#8801;<\/span> <span wj-part="g-rows"><\/span><\/label><div wj-part="d-rows"><\/div><\/td><td width= "50%" style= "border-left-style:solid"><label><span class="wj-glyph">&#931;<\/span> <span wj-part="g-vals"><\/span><\/label><div wj-part="d-vals"><\/div><\/td><\/tr><\/table><div wj-part="d-prog" class="wj-state-selected" style="width:0px;height:3px"><\/div><div style="display:table"><label style="display:table-cell;vertical-align:middle"><input wj-part="chk-defer" type="checkbox"/> <span wj-part="g-defer"><\/span><\/label><a wj-part="btn-update" href="" draggable="false" disabled class="wj-state-disabled"><\/a><\/div><\/div>',r}(n.Control);t.PivotPanel=i})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';var i=function(i){function r(){var t=this;i.call(this,document.createElement('div'),{header:'PivotGrid Context Menu',displayMemberPath:'text',commandParameterPath:'parm',command:{executeCommand:function(n){t._execute(n)},canExecuteCommand:function(n){return t._canExecute(n)}}});this.itemsSource=this._getMenuItems();n.addClass(this.dropDown,'context-menu')}return __extends(r,i),r.prototype.refresh=function(n){n===void 0&&(n=!0);this.itemsSource=this._getMenuItems();i.prototype.refresh.call(this,n)},r.prototype.attach=function(i){var r=this,u;n.assert(i instanceof t.PivotGrid,'Expecting a PivotGrid control...');u=i.hostElement;u.addEventListener('contextmenu',function(t){if(i.customContextMenu&&(t.preventDefault(),r.owner=u,r._selectField(t))){var f=r.dropDown;r.selectedIndex=-1;r.onIsDroppedDownChanging(new n.CancelEventArgs)&&(n.showPopup(f,t),r.onIsDroppedDownChanged(),f.focus())}})},r.prototype._selectField=function(t){this._targetField=null;this._htDown=null;var u=n.Control.getControl(this.owner),r=u.engine,i=u.hitTest(t);switch(i.cellType){case n.grid.CellType.Cell:u.select(i.range);this._targetField=r.valueFields[i.col%r.valueFields.length];this._htDown=i;break;case n.grid.CellType.ColumnHeader:this._targetField=r.columnFields[i.row];break;case n.grid.CellType.RowHeader:this._targetField=r.rowFields[i.col];break;case n.grid.CellType.TopLeft:i.row==i.panel.rows.length-1&&(this._targetField=r.rowFields[i.col])}return this._targetField!=null},r.prototype._getMenuItems=function(){for(var t,u,i=[{text:'<div class="zmdi zmdi-close"></div>Remove Field',parm:'remove'},{text:'<div class="zmdi zmdi-settings"></div>Field Settings...',parm:'edit'},{text:'<div class="wj-separator"></div>'},{text:'<div class="zmdi zmdi-eye"></div>Show Detail...',parm:'detail'}],r=0;r<i.length;r++)t=i[r],t.parm&&(u=n.culture.olap._ListContextMenu[t.parm],n.assert(u,'missing localized text for item '+t.parm),t.text=t.text.replace(/([^>]+$)/,u));return i},r.prototype._execute=function(t){var i=n.Control.getControl(this.owner),r=this._targetField,u=this._htDown;switch(t){case'remove':i.engine.removeField(r);break;case'edit':i.engine.editField(r);break;case'detail':i.showDetail(u.row,u.col)}},r.prototype._canExecute=function(i){var u=n.Control.getControl(this.owner),f=u.engine,r=this._targetField;switch(i){case'remove':return r!=null;case'edit':return r!=null&&u.engine.allowFieldEditing;case'detail':return this._htDown!=null&&r!=null&&!(r instanceof t.CubePivotField)}return!0},r}(n.input.Menu);t._GridContextMenu=i})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';var i=function(i){function r(){i.apply(this,arguments)}return __extends(r,i),r.prototype.getMergedRange=function(r,u,f,e){var s,o;if(e===void 0&&(e=!0),s=r.grid.collectionView,this._ng=s instanceof t.PivotCollectionView?s.engine:null,!this._ng)return i.prototype.getMergedRange.call(this,r,u,f,e);switch(r.cellType){case n.grid.CellType.RowHeader:return o=e?r.viewRange:null,this._getMergedRowHeaderRange(r,u,f,o);case n.grid.CellType.ColumnHeader:return o=e?r.viewRange:null,this._getMergedColumnHeaderRange(r,u,f,o)}return null},r.prototype._getMergedRowHeaderRange=function(t,i,r,u){var h=t.getCellData(i,r,!1),c=r>0?t.getCellData(i,r-1,!1):null,l=this._ng._getRowLevel(i),o,s,a,v,f,e,y,p;if(l>-1&&r>=l){for(a=u?u.col:0,v=u?u.col2:t.columns.length-1,o=r;o>a;o--)if(t.getCellData(i,o-1,!1)!=h)break;for(s=r;s<v;s++)if(t.getCellData(i,s+1,!1)!=h)break;return o!=s?new n.grid.CellRange(i,o,i,s):null}for(y=u?u.row:0,p=u?u.row2:t.rows.length-1,f=i;f>y;f--){if(t.getCellData(f-1,r,!1)!=h)break;if(c&&t.getCellData(f-1,r-1,!1)!=c)break}for(e=i;e<p;e++){if(t.getCellData(e+1,r,!1)!=h)break;if(c&&t.getCellData(e+1,r-1,!1)!=c)break}return f!=e?new n.grid.CellRange(f,r,e,r):null},r.prototype._getMergedColumnHeaderRange=function(t,i,r,u){var w=this._ng._getKey(t.columns[r].binding),h=t.getCellData(i,r,!1),c=i>0?t.getCellData(i-1,r,!1):null,l=this._ng._getColLevel(w),o,s,a,v,f,e,y,p;if(l>-1&&i>=l){for(a=u?u.row:0,v=u?u.row2:t.rows.length-1,o=i;o>a;o--)if(t.getCellData(o-1,r,!1)!=h)break;for(s=i;s<v;s++)if(t.getCellData(s+1,r,!1)!=h)break;if(o!=s)return new n.grid.CellRange(o,r,s,r)}for(y=u?u.col:0,p=u?u.col2:t.columns.length-1,f=r;f>y;f--){if(t.getCellData(i,f-1,!1)!=h)break;if(c&&t.getCellData(i-1,f-1,!1)!=c)break}for(e=r;e<p;e++){if(t.getCellData(i,e+1,!1)!=h)break;if(c&&t.getCellData(i-1,e+1,!1)!=c)break}return f!=e?new n.grid.CellRange(i,f,i,e):null},r}(n.grid.MergeManager);t._PivotMergeManager=i})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';var i=function(i){function r(r,u){i.call(this,r);this._showDetailOnDoubleClick=!0;this._collapsibleSubtotals=!0;this._customCtxMenu=!0;this._showRowFieldSort=!1;this._centerVert=!0;n.addClass(this.hostElement,'wj-pivotgrid');this.isReadOnly=!0;this.deferResizing=!0;this.showAlternatingRows=!1;this.autoGenerateColumns=!1;this.allowDragging=n.grid.AllowDragging.None;this.mergeManager=new t._PivotMergeManager(this);this.customContextMenu=!0;this.initialize(u);this.formatItem.addHandler(this._formatItem,this);this.addEventListener(this.hostElement,'mousedown',this._mousedown.bind(this),!0);this.addEventListener(this.hostElement,'mouseup',this._mouseup.bind(this),!0);this.addEventListener(this.hostElement,'dblclick',this._dblclick.bind(this),!0);this._ctxMenu=new t._GridContextMenu;this._ctxMenu.attach(this)}return __extends(r,i),Object.defineProperty(r.prototype,"engine",{get:function(){return this._ng},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"showDetailOnDoubleClick",{get:function(){return this._showDetailOnDoubleClick},set:function(t){this._showDetailOnDoubleClick=n.asBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"showRowFieldSort",{get:function(){return this._showRowFieldSort},set:function(t){t!=this._showRowFieldSort&&(this._showRowFieldSort=n.asBoolean(t),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"customContextMenu",{get:function(){return this._customCtxMenu},set:function(t){this._customCtxMenu=n.asBoolean(t)},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"collapsibleSubtotals",{get:function(){return this._collapsibleSubtotals},set:function(t){t!=this._collapsibleSubtotals&&(this._collapsibleSubtotals=n.asBoolean(t),this.invalidate())},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"centerHeadersVertically",{get:function(){return this._centerVert},set:function(t){t!=this._centerVert&&(this._centerVert=n.asBoolean(t),this.invalidate())},enumerable:!0,configurable:!0}),r.prototype.getDetail=function(t,i){var r=this.rows[n.asInt(t)].dataItem,u=this.columns[n.asInt(i)].binding;return this._ng.getDetail(r,u)},r.prototype.getKeys=function(t,i){var r=this.rows[n.asInt(t)].dataItem,u=this.columns[n.asInt(i)].binding;return this._ng.getKeys(r,u)},r.prototype.getDetailView=function(t,i){var r=this.rows[n.asInt(t)].dataItem,u=this.columns[n.asInt(i)].binding;return this._ng.getDetailView(r,u)},r.prototype.showDetail=function(i,r){var f=new t.DetailDialog(document.createElement('div')),u;f.showDetail(this,new n.grid.CellRange(i,r));u=new n.input.Popup(document.createElement('div'));u.content=f.hostElement;u.show(!0)},r.prototype.collapseRowsToLevel=function(n){this._collapseRowsToLevel(n)},r.prototype.collapseColumnsToLevel=function(n){this._collapseColsToLevel(n)},r.prototype.refresh=function(n){n===void 0&&(n=!0);this._ctxMenu.refresh();i.prototype.refresh.call(this,n)},r.prototype._getCollectionView=function(i){return i instanceof t.PivotPanel?i=i.engine.pivotView:i instanceof t.PivotEngine&&(i=i.pivotView),n.asCollectionView(i)},r.prototype.onItemsSourceChanged=function(n){this._ng&&this._ng.updatedView.removeHandler(this._updatedView,this);var r=this.collectionView;this._ng=r instanceof t.PivotCollectionView?r.engine:null;this._ng&&this._ng.updatedView.addHandler(this._updatedView,this);this._updatedView();i.prototype.onItemsSourceChanged.call(this,n)},r.prototype.onResizedColumn=function(n){var t=this._ng,r;t&&(n.panel==this.topLeftCells&&n.col<t.rowFields.length&&(r=t.rowFields[n.col],r.width=n.panel.columns[n.col].renderWidth),n.panel==this.columnHeaders&&t.valueFields.length>0&&(r=t.valueFields[n.col%t.valueFields.length],r.width=n.panel.columns[n.col].renderWidth));i.prototype.onResizedColumn.call(this,n)},r.prototype._updatedView=function(){this._updateFixedCounts();this.columns.clear();this.rows.clear()},r.prototype.onLoadedRows=function(r){var f,e,u,o;if(this.columns.length==0&&(f=this.collectionView,f&&f.items.length)){e=f.items[0];for(u in e)u!=t._PivotKey._ROW_KEY_NAME&&(o=new n.grid.Column({binding:u,dataType:e[u]!=null?n.getType(e[u]):n.DataType.Number}),this.columns.push(o))}this._updateFixedContent();i.prototype.onLoadedRows.call(this,r)},r.prototype._updateFixedCounts=function(){var n=this._ng,i=n&&n.isViewDefined,t;t=Math.max(1,i?n.rowFields.length:1);this._setLength(this.topLeftCells.columns,t);t=Math.max(1,i?n.columnFields.length:1);n&&n.columnFields.length&&n.valueFields.length>1&&t++;this._setLength(this.topLeftCells.rows,t)},r.prototype._setLength=function(t,i){while(t.length<i)t.push(t instanceof n.grid.ColumnCollection?new n.grid.Column:new n.grid.Row);while(t.length>i)t.removeAt(t.length-1)},r.prototype._updateFixedContent=function(){var e=this._ng,c=e&&e.isViewDefined,r,h,u,s,i,o,f;if(!c){this.topLeftCells.setCellData(0,0,null);return}for(r=this.topLeftCells,u=0;u<r.rows.length;u++)for(i=0;i<r.columns.length;i++)s=e.rowFields.length&&u==r.rows.length-1?e.rowFields[i].header:'',r.setCellData(u,i,s,!1,!1);for(r=this.rowHeaders,u=0;u<r.rows.length;u++)for(h=r.rows[u].dataItem[t._PivotKey._ROW_KEY_NAME],n.assert(h instanceof t._PivotKey,'missing PivotKey for row...'),i=0;i<r.columns.length;i++)s=h.getValue(i,!0),r.setCellData(u,i,s,!1,!1);for(r=this.columnHeaders,i=0;i<r.columns.length;i++)for(h=e._getKey(r.columns[i].binding),n.assert(h instanceof t._PivotKey,'missing PivotKey for column...'),u=0;u<r.rows.length;u++)s=u==r.rows.length-1&&e.valueFields.length>1?e.valueFields[i%e.valueFields.length].header:h.getValue(u,!0),r.setCellData(u,i,s,!1,!1);for(r=this.topLeftCells,i=0;i<r.columns.length;i++)o=r.columns[i],f=i<e.rowFields.length?e.rowFields[i]:null,o.width=f&&n.isNumber(f.width)?f.width:this.columns.defaultSize,o.wordWrap=f?f.wordWrap:null,o.align=null;for(r=this.cells,i=0;i<r.columns.length;i++)o=r.columns[i],f=e.valueFields.length?e.valueFields[i%e.valueFields.length]:null,o.width=f&&n.isNumber(f.width)?f.width:this.columns.defaultSize,o.wordWrap=f?f.wordWrap:null,o.format=f?f.format:null},r.prototype._formatItem=function(i,r){var u=this._ng,o,s,f,e,h;u&&(r.panel==this.columnHeaders&&(u.valueFields.length<2||r.row<r.panel.rows.length-1)&&(r.cell.style.textAlign=''),o=u._getRowLevel(r.row),s=u._getColLevel(r.panel.columns[r.col].binding),n.toggleClass(r.cell,'wj-aggregate',o>-1||s>-1),this._collapsibleSubtotals&&(r.panel==this.rowHeaders&&u.showRowTotals==t.ShowTotals.Subtotals&&(f=this.getMergedRange(r.panel,r.row,r.col,!1)||r.range,r.col<u.rowFields.length-1&&f.rowSpan>1&&(r.cell.innerHTML=this._getCollapsedGlyph(this._getRowCollapsed(f))+r.cell.innerHTML)),r.panel==this.columnHeaders&&u.showColumnTotals==t.ShowTotals.Subtotals&&(f=this.getMergedRange(r.panel,r.row,r.col,!1)||r.range,r.row<u.columnFields.length-1&&f.columnSpan>1&&(r.cell.innerHTML=this._getCollapsedGlyph(this._getColCollapsed(f))+r.cell.innerHTML))),r.panel==this.topLeftCells&&this.showRowFieldSort&&r.col<u.rowFields.length&&r.row==this._getSortRowIndex()&&(e=u.rowFields[r.col],n.toggleClass(r.cell,'wj-sort-asc',!e.descending),n.toggleClass(r.cell,'wj-sort-desc',e.descending),r.cell.innerHTML+=' <span class="wj-glyph-'+(e.descending?'down':'up')+'"></span>'),this._centerVert&&r.cell.hasChildNodes&&(r.panel==this.rowHeaders||r.panel==this.columnHeaders)&&(h=n.createElement('<div style="display:table-cell;vertical-align:middle"></div>'),this._docRange||(this._docRange=document.createRange()),this._docRange.selectNodeContents(r.cell),this._docRange.surroundContents(h),n.setCss(r.cell,{display:'table',tableLayout:'fixed',paddingTop:0,paddingBottom:0})))},r.prototype._getCollapsedGlyph=function(n){return'<div style="display:inline-block;cursor:pointer" '+r._WJA_COLLAPSE+'><span class="'+(n?'zmdi zmdi-plus':'zmdi zmdi-minus')+'"><\/span><\/div>&nbsp'},r.prototype._mousedown=function(t){var f,i,u;if(t.defaultPrevented||t.button!=0){this._htDown=null;return}if(this._htDown=this.hitTest(t),f=n.closest(t.target,'['+r._WJA_COLLAPSE+']'),f!=null&&this._htDown.panel!=null){i=this._htDown.range;switch(this._htDown.panel.cellType){case n.grid.CellType.RowHeader:u=this._getRowCollapsed(i);t.shiftKey||t.ctrlKey?this._collapseRowsToLevel(i.col+(u?2:1)):this._setRowCollapsed(i,!u);break;case n.grid.CellType.ColumnHeader:u=this._getColCollapsed(i);t.shiftKey||t.ctrlKey?this._collapseColsToLevel(i.row+(u?2:1)):this._setColCollapsed(i,!u)}this._htDown=null;t.preventDefault()}},r.prototype._mouseup=function(t){var i,r,u,f,e;if(this._htDown&&!t.defaultPrevented&&this.hostElement.style.cursor!='col-resize'&&(i=this.hitTest(t),this._htDown.panel==i.panel&&i.range.equals(this._htDown.range))&&(r=this._ng,u=this.topLeftCells,i.panel==u&&i.row==u.rows.length-1&&i.col>-1)){if(this.allowSorting&&i.panel.columns[i.col].allowSorting&&(f=new n.grid.CellRangeEventArgs(i.panel,i.range),this.onSortingColumn(f))){r.pivotView.sortDescriptions.clear();e=r.rowFields[i.col];e.descending=!e.descending;this.onSortedColumn(f)}t.preventDefault()}},r.prototype._dblclick=function(n){if(this._ng&&this._ng.fields.length>0&&!(this._ng.fields[0]instanceof t.CubePivotField)&&!n.defaultPrevented&&this._showDetailOnDoubleClick){var i=this._htDown;i&&i.panel==this.cells&&this.showDetail(i.row,i.col)}},r.prototype._getRowLevel=function(n){return this._ng._getRowLevel(n)},r.prototype._getGroupedRows=function(t){var f=t.col+1,r,i,u;if(this._ng.totalsBeforeData){for(r=t.row;r>0;r--)if(this._getRowLevel(r)==f)break;for(i=t.row;i<this.rows.length-1;i++)if(u=this._getRowLevel(i+1),u>-1&&u<=f)break;r++}else{for(i=t.row;i<this.rows.length;i++)if(this._getRowLevel(i)==f)break;for(r=t.row;r>0;r--)if(u=this._getRowLevel(r-1),u>-1&&u<=f)break;i==this.rows.length&&i--;i--}return i>=r?new n.grid.CellRange(r,t.col,i,t.col2):t},r.prototype._getRowCollapsed=function(n){n=this._getGroupedRows(n);for(var t=n.row;t<=n.row2;t++)if(this.rows[t].isVisible)return!1;return!0},r.prototype._setRowCollapsed=function(n,t){var i=this;this.deferUpdate(function(){n=i._getGroupedRows(n);for(var r=n.row;r<=n.row2;r++)i.rows[r].visible=!t})},r.prototype._toggleRowCollapsed=function(n){this._setRowCollapsed(n,!this._getRowCollapsed(n))},r.prototype._collapseRowsToLevel=function(n){var t=this;n>=this._ng.rowFields.length&&(n=-1);this.deferUpdate(function(){for(var r,i=0;i<t.rows.length;i++)n<0?t.rows[i].visible=!0:(r=t._getRowLevel(i),t.rows[i].visible=r>-1&&r<=n)})},r.prototype._getColLevel=function(n){return this._ng._getColLevel(this.columns[n].binding)},r.prototype._getGroupedCols=function(t){var f=t.row+1,i,r,u;if(this._ng.totalsBeforeData){for(i=t.col;i>0;i--)if(this._getColLevel(i)==f)break;for(r=t.col;r<this.columns.length-1;r++)if(u=this._getColLevel(r+1),u>-1&&u<=f)break;i++}else{for(r=t.col;r<this.columns.length;r++)if(this._getColLevel(r)==f)break;for(i=t.col;i>0;i--)if(u=this._getColLevel(i-1),u>-1&&u<=f)break;r--}return r>=i?new n.grid.CellRange(t.row,i,t.row2,r):t},r.prototype._getColCollapsed=function(n){n=this._getGroupedCols(n);for(var t=n.col;t<=n.col2;t++)if(this.columns[t].isVisible)return!1;return!0},r.prototype._setColCollapsed=function(n,t){var i=this;this.deferUpdate(function(){n=i._getGroupedCols(n);for(var r=n.col;r<=n.col2;r++)i.columns[r].visible=!t})},r.prototype._toggleColCollapsed=function(n){this._setColCollapsed(n,!this._getColCollapsed(n))},r.prototype._collapseColsToLevel=function(n){var t=this;n>=this._ng.columnFields.length&&(n=-1);this.deferUpdate(function(){for(var r,i=0;i<t.columns.length;i++)n<0?t.columns[i].visible=!0:(r=t._getColLevel(i),t.columns[i].visible=r>-1&&r<=n)})},r._WJA_COLLAPSE='wj-pivot-collapse',r}(n.grid.FlexGrid);t.PivotGrid=i})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';n.culture.olap=n.culture.olap||{};n.culture.olap.DetailDialog=window.wijmo.culture.olap.DetailDialog||{header:'Detail View:',ok:'OK',items:'{cnt:n0} items',item:'{cnt} item',row:'Row',col:'Column'};var i=function(i){function r(t,r){var f,u;i.call(this,t,null,!0);f=this.getTemplate();this.applyTemplate('wj-control wj-content wj-detaildialog',f,{_sCnt:'sp-cnt',_dSummary:'div-summary',_dGrid:'div-grid',_btnOK:'btn-ok',_gHdr:'g-hdr'});u=n.culture.olap.DetailDialog;this._gHdr.textContent=u.header;this._btnOK.textContent=u.ok;this._g=new n.grid.FlexGrid(this._dGrid,{isReadOnly:!0});this.initialize(r)}return __extends(r,i),r.prototype.showDetail=function(i,r){var v=this,u=i.getDetailView(r.row,r.col),e,l,o;this._g.itemsSource=u;e=n.tryCast(u,'IPagedCollectionView');this._updateDetailCount(e?e.totalItemCount:u.items.length);u.collectionChanged.addHandler(function(){v._updateDetailCount(u.items.length)});var s=i.engine,h=n.culture.olap.DetailDialog,f='',y=i.rows[r.row].dataItem[t._PivotKey._ROW_KEY_NAME],c=this._getHeader(y);c&&(f+=h.row+': <b>'+n.escapeHtml(c)+'</b><br>');l=s._getKey(i.columns[r.col].binding);o=this._getHeader(l);o&&(f+=h.col+': <b>'+n.escapeHtml(o)+'</b><br>');var a=s.valueFields,p=a[r.col%a.length],w=p.header,b=i.getCellData(r.row,r.col,!0);f+=n.escapeHtml(w)+': <b>'+n.escapeHtml(b)+'</b>';this._dSummary.innerHTML=f},r.prototype._updateDetailCount=function(t){var i=n.culture.olap.DetailDialog;this._sCnt.textContent=n.format(t==1?i.item:i.items,{cnt:t})},r.prototype._getHeader=function(n){var i,t;if(n.values.length){for(i=[],t=0;t<n.values.length;t++)i.push(n.getValue(t,!0));return i.join(' - ')}return null},r.controlTemplate='<div><div class="wj-dialog-header"><span wj-part="g-hdr">Detail View:<\/span> <span wj-part="sp-cnt"><\/span><\/div><div class="wj-dialog-body"><div wj-part="div-summary" class="tab-hed-tiltesCo"><\/div><div wj-part="div-grid"><\/div><\/div><div class="wj-dialog-footer"><a class="wj-hide" wj-part="btn-ok" href="" tabindex="-1" draggable="false">OK<\/a>&nbsp;&nbsp;<\/div><\/div>',r}(n.Control);t.DetailDialog=i})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}));__extends=this&&this.__extends||function(n,t){function r(){this.constructor=n}for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);n.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)},function(n){var t;(function(t){'use strict';n.culture.olap=n.culture.olap||{};n.culture.olap.PivotChart=window.wijmo.culture.olap.PivotChart||{by:'by',and:'and'},function(n){n[n.Column=0]="Column";n[n.Bar=1]="Bar";n[n.Scatter=2]="Scatter";n[n.Line=3]="Line";n[n.Area=4]="Area";n[n.Pie=5]="Pie"}(t.PivotChartType||(t.PivotChartType={}));var i=t.PivotChartType,r=function(r){function u(t,f){r.call(this,t);this._chartType=i.Column;this._showHierarchicalAxes=!0;this._showTotals=!1;this._maxSeries=u.MAX_SERIES;this._maxPoints=u.MAX_POINTS;this._stacking=n.chart.Stacking.None;this._colItms=[];this._dataItms=[];this._lblsSrc=[];this._grpLblsSrc=[];n.addClass(this.hostElement,'wj-pivotchart');this._isPieChart()?this._createFlexPie():this._createFlexChart();r.prototype.initialize.call(this,f)}return __extends(u,r),Object.defineProperty(u.prototype,"engine",{get:function(){return this._ng},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"itemsSource",{get:function(){return this._itemsSource},set:function(i){if(i&&this._itemsSource!==i){var r=this._itemsSource;i instanceof t.PivotPanel?i=i.engine.pivotView:i instanceof t.PivotEngine&&(i=i.pivotView);this._itemsSource=n.asCollectionView(i);this._onItemsSourceChanged(r)}},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"chartType",{get:function(){return this._chartType},set:function(t){t!=this._chartType&&(this._chartType=n.asEnum(t,i),this._changeChartType())},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"showHierarchicalAxes",{get:function(){return this._showHierarchicalAxes},set:function(t){t!=this._showHierarchicalAxes&&(this._showHierarchicalAxes=n.asBoolean(t,!0),!this._isPieChart()&&this._flexChart&&this._updateFlexChart(this._dataItms,this._lblsSrc,this._grpLblsSrc))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"showTotals",{get:function(){return this._showTotals},set:function(t){t!=this._showTotals&&(this._showTotals=n.asBoolean(t,!0),this._updatedPivotChart())},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"stacking",{get:function(){return this._stacking},set:function(t){t!=this._stacking&&(this._stacking=n.asEnum(t,n.chart.Stacking),this._flexChart&&(this._flexChart.stacking=this._stacking,this.refresh()))},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"maxSeries",{get:function(){return this._maxSeries},set:function(t){t!=this._maxSeries&&(this._maxSeries=n.asNumber(t),this._updatedPivotChart())},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"maxPoints",{get:function(){return this._maxPoints},set:function(t){t!=this._maxPoints&&(this._maxPoints=n.asNumber(t),this._updatedPivotChart())},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"flexChart",{get:function(){return this._flexChart},enumerable:!0,configurable:!0}),Object.defineProperty(u.prototype,"flexPie",{get:function(){return this._flexPie},enumerable:!0,configurable:!0}),u.prototype.refresh=function(n){n===void 0&&(n=!0);r.prototype.refresh.call(this,n);this._isPieChart()?this._flexPie&&this._flexPie.refresh(n):this._flexChart&&this._flexChart.refresh(n)},u.prototype._onItemsSourceChanged=function(n){this._ng&&this._ng.updatedView.removeHandler(this._updatedPivotChart,this);n&&n.collectionChanged.removeHandler(this._updatedPivotChart,this);var i=this._itemsSource;this._ng=i instanceof t.PivotCollectionView?i.engine:null;this._ng&&this._ng.updatedView.addHandler(this._updatedPivotChart,this);this._itemsSource&&this._itemsSource.collectionChanged.addHandler(this._updatedPivotChart,this);this._updatedPivotChart()},u.prototype._createFlexChart=function(){var r=this,i=document.createElement('div');this.hostElement.appendChild(i);this._flexChart=new n.chart.FlexChart(i);this._flexChart.legend.position=n.chart.Position.Right;this._flexChart.bindingX=t._PivotKey._ROW_KEY_NAME;this._flexChart.stacking=this._stacking;this._flexChart.tooltip.content=function(n){return'<b>'+n.name+"<\/b> <br/>"+r._getLabel(n.x)+' '+n._yfmt};this._flexChart.hostElement.style.visibility='hidden'},u.prototype._createFlexPie=function(){var r=this,u=document.createElement('div'),i;this.hostElement.appendChild(u);this._colMenu=new n.input.Menu(u);this._colMenu.displayMemberPath='text';this._colMenu.selectedValuePath='prop';this._colMenu.hostElement.style.visibility='hidden';i=document.createElement('div');this.hostElement.appendChild(i);this._flexPie=new n.chart.FlexPie(i);this._flexPie.bindingName=t._PivotKey._ROW_KEY_NAME;this._flexPie.tooltip.content=function(n){return'<b>'+r._getLabel(r._dataItms[n.pointIndex][t._PivotKey._ROW_KEY_NAME])+"<\/b> <br/>"+n._yfmt};this._flexPie.rendering.addHandler(this._updatePieInfo,this)},u.prototype._updatedPivotChart=function(){var h,e,o=[],a=[],i=[],r=0,c,v,u,y,p,s,f,n,l;if(this._ng&&this._ng.pivotView){for(h=this._ng.pivotView,e=this._ng.rowFields,f=0;f<h.items.length;f++){if(u=h.items[f],c=u.$rowKey,f===0&&this._getColumns(u),o.length>=this._maxPoints)break;if(!this._isTotalRow(u[t._PivotKey._ROW_KEY_NAME])){for(o.push(u),a.push({value:o.length-1,text:this._getLabel(u[t._PivotKey._ROW_KEY_NAME])}),n=0;n<e.length;n++)i.length<=n&&i.push([]),p=this._getMergeIndex(c,v),p<n?(r=i[n].length-1,s=i[n][r],r===0&&n<e.length-1&&(s.value=(s.width-1)/2),r>0&&n<e.length-1&&(y=this._getOffsetWidth(i[n]),s.value=y+(s.width-1)/2),i[n].push({value:o.length-1,text:c.getValue(n,!0),width:1})):(r=i[n].length-1,i[n][r].width=i[n][r].width+1);v=c}if(f===h.items.length-1)for(n=0;n<e.length;n++)n<this._ng.rowFields.length-1&&(l=i[n].length-1,i[n][l].value=this._getOffsetWidth(i[n])+(i[n][l].width-1)/2)}this._dataItms=o;this._lblsSrc=a;this._grpLblsSrc=i;this._updateFlexChartOrPie()}},u.prototype._updateFlexChartOrPie=function(){var n=this._isPieChart();!n&&this._flexChart?this._updateFlexChart(this._dataItms,this._lblsSrc,this._grpLblsSrc):n&&this._flexPie&&this._updateFlexPie(this._dataItms,this._lblsSrc)},u.prototype._updateFlexChart=function(n,t,i){var r,f,u;if(this._ng&&this._flexChart){if(r=this._flexChart,f=r.hostElement,r.beginUpdate(),r.itemsSource=n,this._createSeries(),f.style.visibility=r.series&&r.series.length>0&&n.length>0?'visible':'hidden',r.header=this._getChartTitle(),this._isBarChart()){if(this._showHierarchicalAxes){if(r.axisY.itemsSource=i[i.length-1],r.axisX.labelAngle=undefined,i.length>=2)for(u=i.length-2;u>=0;u--)this._createGroupAxes(i[u])}else r.axisY.labelAngle=undefined,r.axisY.itemsSource=t;r.axisX.itemsSource=undefined}else{if(this._showHierarchicalAxes){if(r.axisX.itemsSource=i[i.length-1],i.length>=2)for(u=i.length-2;u>=0;u--)this._createGroupAxes(i[u])}else r.axisX.labelAngle=undefined,r.axisX.itemsSource=t;r.axisY.itemsSource=undefined}r.axisX.labelPadding=6;r.axisY.labelPadding=6;r.axisY.format=this._ng.valueFields.length>0&&this._ng.valueFields[0].format?this._ng.valueFields[0].format:'';r.endUpdate()}},u.prototype._updateFlexPie=function(n){var r,i,u,f;this._ng&&this._flexPie&&(r=this._flexPie,f=r.hostElement,i=this._colMenu,f.style.visibility=this._colItms.length>0&&n.length>0?'visible':'hidden',r.beginUpdate(),r.itemsSource=n,r.bindingName=t._PivotKey._ROW_KEY_NAME,this._colItms&&this._colItms.length>0&&(r.binding=this._colItms[0].prop),r.header=this._getChartTitle(),r.endUpdate(),u=this._getTitle(this._ng.columnFields),u!==''&&(u='<b>'+u+': </b>'),this._colItms&&this._colItms.length>1&&n.length>0?(i.hostElement.style.visibility='visible',i.header=u+this._colItms[0].text,i.itemsSource=this._colItms,i.command={executeCommand:function(){var n=i.selectedItem;i.header=u+n.text;r.binding=n.prop}},i.selectedIndex=0,i.invalidate(),i.listBox.invalidate()):i.hostElement.style.visibility='hidden')},u.prototype._createSeries=function(){var i,t;for(this._flexChart&&(this._flexChart.series.length=0),t=0;t<this._colItms.length;t++)i=new n.chart.Series,i.binding=this._colItms[t].prop,i.name=this._colItms[t].text,this._flexChart.series.push(i)},u.prototype._getColumns=function(n){var u=0,r,f,i;if(n){this._colItms.length=0;for(i in n)n.hasOwnProperty(i)&&i!==t._PivotKey._ROW_KEY_NAME&&u<this._maxSeries&&(this._showTotals&&this._isTotalColumn(i)||!this._showTotals&&!this._isTotalColumn(i))&&(r=this._ng._getKey(i),f=this._getLabel(r),this._colItms.push({prop:i,text:this._getLabel(r)}),u++)}},u.prototype._createGroupAxes=function(t){var o=this,e=this._flexChart,r=this._isBarChart()?e.axisY:e.axisX,i,f;t&&(i=new n.chart.Axis,i.labelAngle=0,i.labelPadding=6,i.position=this._isBarChart()?n.chart.Position.Left:n.chart.Position.Bottom,i.majorTickMarks=n.chart.TickMark.None,i.itemsSource=t,i.itemFormatter=function(n,r){var v=t.filter(function(n){return n.value==r.val})[0],s,f,h,c,e,l,a;return s=.5*v.width,o._isBarChart()?(l=i.convert(r.val+s)+5,a=i.convert(r.val-s)-5,f=i._axrect.left+i._axrect.width-5,n.drawLine(f,l,f,a,u.HRHAXISCSS),n.drawLine(f,l,f+5,l,u.HRHAXISCSS),n.drawLine(f,a,f+5,a,u.HRHAXISCSS),n.drawLine(f,r.pos.y,f-5,r.pos.y,u.HRHAXISCSS)):(h=i.convert(r.val-s)+5,c=i.convert(r.val+s)-5,e=i._axrect.top,n.drawLine(h,e,c,e,u.HRHAXISCSS),n.drawLine(h,e,h,e-5,u.HRHAXISCSS),n.drawLine(c,e,c,e-5,u.HRHAXISCSS),n.drawLine(r.pos.x,e,r.pos.x,e+5,u.HRHAXISCSS)),r},i.min=r.actualMin,i.max=r.actualMax,r.rangeChanged.addHandler(function(){i.min=r.actualMin;i.max=r.actualMax}),f=new n.chart.Series,f.visibility=n.chart.SeriesVisibility.Hidden,this._isBarChart()?f.axisY=i:f.axisX=i,e.series.push(f))},u.prototype._updateFlexPieBinding=function(){this._flexPie.binding=this._colMenu.selectedValue;this._flexPie.refresh()},u.prototype._updatePieInfo=function(){var n=this;this._flexPie&&(this._flexPie._labels=this._flexPie._labels.map(function(t,i){return n._lblsSrc[i].text}))},u.prototype._changeChartType=function(){var t=null;if(this.chartType===i.Pie)this._flexPie||this._createFlexPie(),this._updateFlexPie(this._dataItms,this._lblsSrc),this._swapChartAndPie(!1);else{switch(this.chartType){case i.Column:t=n.chart.ChartType.Column;break;case i.Bar:t=n.chart.ChartType.Bar;break;case i.Scatter:t=n.chart.ChartType.Scatter;break;case i.Line:t=n.chart.ChartType.Line;break;case i.Area:t=n.chart.ChartType.Area}this._flexChart?(this._flexChart.hostElement.style.display==='none'||t===i.Bar||this._flexChart.chartType===n.chart.ChartType.Bar)&&this._updateFlexChart(this._dataItms,this._lblsSrc,this._grpLblsSrc):(this._createFlexChart(),this._updateFlexChart(this._dataItms,this._lblsSrc,this._grpLblsSrc));this._flexChart.chartType=t;this._swapChartAndPie(!0)}},u.prototype._swapChartAndPie=function(n){this._flexChart&&(this._flexChart.hostElement.style.display=n?'block':'none');this._flexPie&&(this._flexPie.hostElement.style.display=n?'none':'block');this._colMenu&&this._colMenu.hostElement&&(this._colMenu.hostElement.style.display=n?'none':'block')},u.prototype._getLabel=function(n){var t='',i;if(!n||!n.values)return t;switch(n.values.length){case 0:n._valueFields&&(t+=n.valueFields[n._valueFieldIndex].header);break;case 1:t+=n.getValue(0,!0);this._ng.valueFields.length>1&&n.valueFields&&n.valueFields.length>0&&(t+='; '+n.valueFields[n._valueFieldIndex].header);break;default:for(i=0;i<n.values.length;i++)i>0&&(t+="; "),t+=n.getValue(i,!0);this._ng.valueFields.length>1&&n.valueFields&&n.valueFields.length>0&&(t+='; '+n.valueFields[n._valueFieldIndex].header)}return t},u.prototype._getChartTitle=function(){var t=this._ng,u=this._getTitle(t.valueFields),f=this._getTitle(t.rowFields),r=this._getTitle(t.columnFields),i='';return this._dataItms.length>0&&(i=n.format('{value} {by} {rows}',{value:u,by:n.culture.olap.PivotChart.by,rows:f}),r&&(i+=n.format(' {and} {cols}',{and:n.culture.olap.PivotChart.and,cols:r}))),i},u.prototype._getTitle=function(n){for(var t='',i=0;i<n.length;i++)t.length>0&&(t+='; '),t+=n[i].header;return t},u.prototype._isTotalColumn=function(n){var t=n.split(';');return t&&t.length-2<this._ng.columnFields.length?!0:!1},u.prototype._isTotalRow=function(n){return n.values.length<this._ng.rowFields.length?!0:!1},u.prototype._isPieChart=function(){return this._chartType===i.Pie},u.prototype._isBarChart=function(){return this._chartType===i.Bar},u.prototype._getMergeIndex=function(t,i){var u=-1,f,e,r;if(t!=null&&i!=null&&t.values.length==i.values.length)for(r=0;r<t.values.length;r++)if(f=t.fields[r].format===''?t.values[r]:n.Globalize.format(t.values[r],t.fields[r].format),e=i.fields[r].format===''?i.values[r]:n.Globalize.format(i.values[r],i.fields[r].format),f===e)u=r;else return u;return u},u.prototype._getOffsetWidth=function(n){var i=0,t;if(n.length<=1)return i;for(t=0;t<n.length-1;t++)i+=n[t].width;return i},u.MAX_SERIES=100,u.MAX_POINTS=100,u.HRHAXISCSS='wj-hierarchicalaxes-line',u}(n.Control);t.PivotChart=r})(t=n.olap||(n.olap={}))}(wijmo||(wijmo={}))
