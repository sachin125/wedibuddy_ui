!function(){"use strict";angular.module("angular-loading-bar",["cfp.loadingBarInterceptor"]),angular.module("chieffancypants.loadingBar",["cfp.loadingBarInterceptor"]),angular.module("cfp.loadingBarInterceptor",["cfp.loadingBar"]).config(["$httpProvider",function(a){var b=["$q","$cacheFactory","$timeout","$rootScope","$log","cfpLoadingBar",function(b,c,d,e,f,g){function l(){d.cancel(k),g.complete(),i=0,h=0}function m(b){var d,e=c.get("$http"),f=a.defaults;!b.cache&&!f.cache||!1===b.cache||"GET"!==b.method&&"JSONP"!==b.method||(d=angular.isObject(b.cache)?b.cache:angular.isObject(f.cache)?f.cache:e);var g=void 0!==d&&void 0!==d.get(b.url);return void 0!==b.cached&&g!==b.cached?b.cached:(b.cached=g,g)}var k,h=0,i=0,j=g.latencyThreshold;return{request:function(a){return a.ignoreLoadingBar||m(a)||(e.$broadcast("cfpLoadingBar:loading",{url:a.url}),0===h&&(k=d(function(){g.start()},j)),h++,g.set(i/h)),a},response:function(a){return a&&a.config?(a.config.ignoreLoadingBar||m(a.config)||(i++,e.$broadcast("cfpLoadingBar:loaded",{url:a.config.url,result:a}),i>=h?l():g.set(i/h)),a):(f.error("Broken interceptor detected: Config object not supplied in response:\n https://github.com/chieffancypants/angular-loading-bar/pull/50"),a)},responseError:function(a){return a&&a.config?(a.config.ignoreLoadingBar||m(a.config)||(i++,e.$broadcast("cfpLoadingBar:loaded",{url:a.config.url,result:a}),i>=h?l():g.set(i/h)),b.reject(a)):(f.error("Broken interceptor detected: Config object not supplied in rejection:\n https://github.com/chieffancypants/angular-loading-bar/pull/50"),b.reject(a))}}}];a.interceptors.push(b)}]),angular.module("cfp.loadingBar",[]).provider("cfpLoadingBar",function(){this.autoIncrement=!0,this.includeSpinner=!0,this.includeBar=!0,this.latencyThreshold=100,this.startSize=.02,this.parentSelector="div #loading-bar-file-uploader",this.spinnerTemplate='<div id="loading-bar-spinner"><div class="spinner-icon"></div></div>',this.loadingBarTemplate='<div id="loading-bar"><div class="bar"><div class="peg"></div></div></div>',this.$get=["$injector","$document","$timeout","$rootScope",function(a,b,c,d){function r(){if(e||(e=a.get("$animate")),c.cancel(k),!l){var h=b[0],j=h.querySelector?h.querySelector(f):b.find(f)[0];j||(j=h.getElementsByTagName("body")[0]);var m=angular.element(j),n=j.lastChild&&angular.element(j.lastChild);d.$broadcast("cfpLoadingBar:started"),l=!0,p&&e.enter(g,m,n),o&&e.enter(i,m,g),s(q)}}function s(a){if(l){a>100&&(a=100);var b=a+"%";h.css("width",b),m=a,n&&(c.cancel(j),j=c(function(){t()},250))}}function t(){if(m>=97)return d.$broadcast("cfpLoadingBar:status97"),m;m+=v(0,10),s(m)}function u(){return m}function v(a,b){return a+Math.floor(Math.random()*(b-a))}function w(){m=0,l=!1}function x(){e||(e=a.get("$animate")),d.$broadcast("cfpLoadingBar:completed"),c.cancel(k),k=c(function(){var a=e.leave(g,w);a&&a.then&&a.then(w),e.leave(i)},500)}var e,j,k,f=this.parentSelector,g=angular.element(this.loadingBarTemplate),h=g.find("div").eq(0),i=angular.element(this.spinnerTemplate),l=!1,m=0,n=this.autoIncrement,o=this.includeSpinner,p=this.includeBar,q=this.startSize;return{start:r,set:s,status:u,inc:t,complete:x,autoIncrement:this.autoIncrement,includeSpinner:this.includeSpinner,latencyThreshold:this.latencyThreshold,parentSelector:this.parentSelector,startSize:this.startSize}}]})}();
